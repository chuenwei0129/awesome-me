---
title: 前端路由
toc: content
---

## 路由简介

路由这个概念最先是在后端出现的。在以前用模板引擎开发页面时，经常会看到类似 `http://www.xxx.com/login` 这样的 URL。其大致流程可以看成这样：

1. 浏览器发出请求。
2. 服务器监听到 80 端口（或 443）有请求过来，并解析 URL 路径。
3. 根据服务器的路由配置，返回相应信息（可以是 HTML 字符串，也可以是 JSON 数据，图片等）。
4. 浏览器根据数据包的 `Content-Type` 来决定如何解析数据。

简单来说，路由就是用来跟后端服务器进行交互的一种方式，通过不同的路径来请求不同的资源。请求不同的页面是路由的其中一种功能。

## 前端路由

### 1. hash 模式

随着 AJAX 的流行，异步数据请求交互可以在不刷新浏览器的情况下进行。而异步交互体验的更高级版本就是 SPA（单页应用）。单页应用不仅仅在页面交互时是无刷新的，连页面跳转也是无刷新的。为了实现单页应用，前端路由应运而生。

类似于服务端路由，前端路由实现起来也很简单，就是匹配不同的 URL 路径，进行解析，然后动态地渲染出区域 HTML 内容。但是这样存在一个问题，就是 URL 每次变化的时候都会造成页面的刷新。**解决问题的思路便是在改变 URL 的情况下，保证页面不刷新**。

在 2014 年之前，大家是通过 hash 来实现路由，比如 `http://www.xxx.com/#/login` 这种 URL。URL 中的 `#` 后面的变化并不会导致浏览器向服务器发出请求，浏览器不发出请求，也就不会刷新页面。另外，每次 hash 值的变化还会触发 `hashchange` 这个事件，通过这个事件我们可以知道 hash 值发生了哪些变化。然后我们便可以监听 `hashchange` 来实现更新页面部分内容的操作：

```javascript
function matchAndUpdate() {
  // todo 匹配 hash 做 dom 更新操作
}

window.addEventListener('hashchange', matchAndUpdate);
```

### 2. history 模式

2014 年后，随着 HTML5 标准发布，多了两个 API：`pushState` 和 `replaceState`。通过这两个 API 可以改变 URL 地址且不会发送请求。同时还有 `popstate` 事件。通过这些就能用另一种方式来实现前端路由，但实现原理和 hash 实现相同。

用了 HTML5 的实现，单页路由的 URL 就不会多出一个 `#`，变得更加美观。但因为没有 `#`，所以当用户刷新页面之类的操作时，浏览器还是会向服务器发送请求。**为了避免这种情况，这种实现需要服务器的支持，需要把所有路由都重定向到根页面**。

```javascript
function matchAndUpdate() {
  // todo 匹配路径 做 dom 更新操作
}

window.addEventListener('popstate', matchAndUpdate);
```
