---
group:
  title: 2023 🐰
  order: -2023
title: 并发控制
toc: content
---

业务中，经常存在通过一堆 ids，批量获取的场景，

设备状态检查 ：批量获取一批设备的运行状态和健康状况。
获取用户详细信息 ：通过一堆用户ID获取详细的用户资料。
批量下载文件 ：批量下载多个文件（例如，文档、图片、音频等）。
产品库存查询 ：根据一批产品ID批量查询库存。
订单状态更新 ：批量更新多个订单的状态。
批量发送电子邮件 ：根据一批用户ID或邮件地址批量发送电子邮件。
社交媒体数据抓取 ：通过用户ID批量获取用户在社交媒体平台上的数据。
批量价格更新 ：根据一批产品ID批量更新产品价格。
地址验证 ：批量验证和标准化一批地址数据。
批量导入客户数据 ：批量导入客户信息到CRM系统。
物流跟踪信息获取 ：根据一批快递单号批量获取物流跟踪信息。
批量生成发票 ：根据一批订单生成对应的发票。
学术期刊数据抓取 ：根据一批文献ID获取学术期刊的摘要和全文链接。
视频库存更新 ：根据一批视频ID批量更新库存和状态。
广告投放数据获取 ：批量获取多个广告投放的效果数据。

上述场景中的每一种都可能涉及类似的挑战，包括处理大量数据、保证请求的成功率和效率，以及优化网络请求的并发性。

## 优化网络请求的并发性

这里先交代下背景，笔者的系统是运行在 http2 上的，由于 http2 支持并发处理，所以在笔者的系统里，后端接口设计是基于这个假设的，后端不会提供批量获取的接口，需要前端通过 id 来逐个获取。

API请求负载管理 ：通过批量请求管理API请求以避免单次大请求引起负载问题。

当同时发送上千个请求时，浏览器会变的明显卡顿，虽然这样发送可以更快的获取数据，但会带来不好的用户体验，笔者的解决方案是，给并发添加最大数量限制。

这里我们将问题定义为，给你ids和并发限制max

补充一点，如果是 http1.1，浏览器会有默认的并发限制，并不需要我们处理这个问题，比如Chrome 中并发数量是6个，所以这个问题的成立，建立在 http2 的基础上。

## 处理大量数据

设备状态检查 ：批量获取一批设备的运行状态和健康状况。

以这个例子，展开说说

## 保证请求的成功率和效率
