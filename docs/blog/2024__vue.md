---

group:
  title: 2024 ğŸ²
  order: -2024
title: Vue3 å®è·µå¿ƒå¾—
# toc: content
order: -99
---

Vue çš„å°±ä¸šæœºä¼šæ¯” React æ›´å¤š

> Vue æ˜¯ä¸ºäº†å·¥ä½œï¼Œè€Œ React å…¨å‡­çƒ­çˆ±ã€‚

åœ¨æ­¤è®°å½•æˆ‘çš„ Vue3 å®è·µç»éªŒ

å°½ç®¡è®¸å¤šäººè®¤ä¸º React çš„å¿ƒæ™ºæ¨¡å‹å¤æ‚ä¸”éš¾ä»¥æŒæ¡ï¼Œä½†å°±æˆ‘ä»¥å¾€ä½¿ç”¨ Vue çš„ç»éªŒï¼ŒVue çš„å¼€å‘è€…ä½“éªŒï¼ˆDXï¼‰è¿œä¸å¦‚ Reactã€‚è™½ç„¶ Vue çš„ DX ä¸ç®—å·®ï¼Œä½†ç¡®å®ä»¤äººçƒ¦æ¼ã€‚

é¦–å…ˆæ˜¯ VSCode å¯¹ Vue TypeScript æ”¯æŒçš„ç³Ÿç³•è¡¨ç°ã€‚

åœ¨ç¼–å†™ Vue3 é¡¹ç›®æ—¶ï¼Œæˆ‘å‡ ä¹æ¯å¤©éƒ½éœ€è¦æŒ‰ä¸‹ Command + P å¹¶é‡å¯çª—å£ä¸‰æ¬¡ä»¥ä¸Šã€‚æ¯å½“æˆ‘å¯¼å…¥ä¸€ä¸ªæ¨¡å—ä½† Intellisense æ— æ³•è‡ªåŠ¨æç¤ºå’Œè¡¥å…¨æ—¶ï¼Œæˆ‘å°±çŸ¥é“éœ€è¦é‡æ–°åŠ è½½ VSCode çª—å£äº†ã€‚

## é¡¹ç›®åˆå§‹åŒ–ï¼šcreate-vue

```js
pnpm create vue
?è¯·è¾“å…¥é¡¹ç›®åç§°ï¼š > é¡¹ç›®çš„åå­—
?æ˜¯å¦ä½¿ç”¨ Typescript è¯­æ³•ï¼Ÿ > æ˜¯
?æ˜¯å¦å¯ç”¨ JSX æ”¯æŒï¼Ÿ > æ˜¯
?æ˜¯å¦å¼•å…¥ Vue Router è¿›è¡Œå•é¡µé¢åº”ç”¨å¼€å‘ï¼Ÿ > æ˜¯
?æ˜¯å¦å¼•å…¥ Pinia ç”¨äºçŠ¶æ€ç®¡ç† > æ˜¯
?æ˜¯å¦å¼•å…¥ Vitest ç”¨äºå•å…ƒæµ‹è¯• > æ˜¯(æ¨è)
?æ˜¯å¦è¦å¼•å…¥ä¸€æ¬¾ç«¯åˆ°ç«¯æµ‹è¯•å·¥å…·ï¼Ÿ > å¦
?æ˜¯å¦å¼•å…¥ ESLint ç”¨äºä»£ç è´¨é‡æ£€æµ‹ï¼Ÿ > æ˜¯
?æ˜¯å¦å¼•å…¥ Prettier ç”¨æˆ·ä»£ç æ ¼å¼åŒ–? > æ˜¯
?æ˜¯å¦å¼•å…¥ Vue DevTools 7 æ‰©å±•ç”¨äºè°ƒè¯•ï¼Ÿ > æ˜¯
```

## ä¸ºä»€ä¹ˆè¦å¯ç”¨ JSX æ”¯æŒï¼Ÿ

ç­”ï¼šä¸ä»…è¦å¯ç”¨ JSX æ”¯æŒï¼Œå¼€å‘æ—¶è¿˜åº”å½»åº•ä½¿ç”¨ JSX æ¥ç¼–å†™ç»„ä»¶ï¼Œè€Œä¸æ˜¯å•æ–‡ä»¶ç»„ä»¶ï¼ˆSFCï¼‰ã€‚è¯·ä¸è¦è¯¯ä¼šï¼Œè¿™å¹¶éå› ä¸º SFC å­˜åœ¨é—®é¢˜ã€‚SFC éå¸¸ä¼˜ç§€ï¼Œç”šè‡³èƒ½æ›´å¥½åœ°åˆ©ç”¨ç¼–è¯‘å¹¶æå‡æ€§èƒ½ã€‚ä½†åŸå› åªæœ‰ä¸€ä¸ªâ€”â€”Vue Official TS æ”¯æŒä¸å¤Ÿç†æƒ³ã€‚

## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Piniaï¼Ÿ

Pinia æœ¬èº«å¹¶æ²¡æœ‰ç‰¹åˆ«ä¹‹å¤„ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨å…¨å±€ reactive è¿›è¡Œæ›¿ä»£ã€‚å°½ç®¡ SSR å­˜åœ¨æ¼æ´ï¼ˆå¹¸è¿çš„æ˜¯æˆ‘ä½¿ç”¨ Vue æ ¹æœ¬ä¸æ¶‰åŠ SSRï¼‰ï¼Œåœ¨å…¥å£ç»„ä»¶ä¸­åˆå§‹åŒ– reactive é…åˆä¾èµ–æ³¨å…¥ä¹Ÿèƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

Pinia å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. åœ¨ TypeScript ä¸‹ç®€åŒ–ç±»å‹è®¡ç®—

   è®©ä»£ç æ›´ç®€æ´ï¼ˆä¾‹å¦‚ `const token = symbol as InjectionKey<ReturnType<typeof hook>>`ï¼‰

2. æƒ°æ€§åˆå§‹åŒ–é€»è¾‘ï¼šåˆå§‹åŒ–ä»£ç ï¼ˆä¾‹å¦‚ `localStorage.get('token')`ï¼‰åœ¨åº”ç”¨å¯åŠ¨æ—¶ä¸è¿è¡Œï¼Œåªåœ¨é¦–æ¬¡ä½¿ç”¨ store çš„ç»„ä»¶ä¸­åˆå§‹åŒ–ã€‚è¿™ä¸€ç‰¹æ€§é…åˆå¼€å‘å·¥å…·ï¼Œå¯æ˜¾è‘—ç®€åŒ–ä¸šåŠ¡è°ƒè¯•ã€‚

æ€»ä¹‹ï¼ŒPinia çš„ä¼˜åŠ¿æ˜¾è€Œæ˜“è§ï¼Œè€ŒåŠ£åŠ¿åœ¨äºç”Ÿå‘½å‘¨æœŸçš„è°¨æ…ä½¿ç”¨ã€‚ä½†åœ¨å…¶ä»–æ–¹é¢ï¼ŒPinia çš„å¼€å‘ä¸æ™®é€š hook æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚

## æˆ‘çš„ Vue3 ç»„ä»¶ç¼–å†™æ–¹å¼

ç”±äº Vue3 å¹¶æ²¡æœ‰å®Œå…¨åºŸå¼ƒé€‰é¡¹å¼ï¼Œå› æ­¤è¿˜æœªå‡ºç°ä¸€ç§å›ºå®šä¸”åŠŸèƒ½å®Œå–„çš„å†™æ³•ï¼ˆtemplate SFC ç¼ºå°‘æ¨¡æ¿å¼•ç”¨å˜é‡ï¼Œæ— æ³•æ›¿ä»£ JSX çš„ç¼–ç¨‹èƒ½åŠ›ï¼‰ã€‚ç›®å‰å¸¸è§çš„å†™æ³•åŒ…æ‹¬é€‰é¡¹å¼ã€ç»„åˆå¼ã€JSX renderã€defineComponent JSX å’Œ defineComponent åŒé‡è¿”å›å‡½æ•° JSX äº”ç§ã€‚

ä»¥ä¸‹æ˜¯æˆ‘åœ¨ Vue3 ä¸­å®Œæ•´çš„å®è·µæ–¹æ¡ˆï¼š

```js
import { defineComponent, reactive, ref } from "vue"

// ä¸ä½¿ç”¨ props å’Œ emits çš„ç»„ä»¶
// const TextInput = defineComponent(() => {
//   const inputText = ref('')
//   return () => <input v-model={inputText.value} />
// })

// ä½¿ç”¨ props å’Œ emits çš„ç»„ä»¶
class UserProfile {
  username = ''
  age = 0
  traits: string[] = []
}

// å­ç»„ä»¶
const UserDetail = defineComponent({
  expose: [],
  props: {
    profile: {
      type: UserProfile,
      default: new UserProfile()
    },
    modelValue: {
      type: String,
      default: ''
    },
  },
  emits: {
    'update:modelValue': (() => true) as (value: string) => void
  },
  setup(props, { emit, slots }) {

    // é™æ€èŠ‚ç‚¹
    const header = <h1>Welcome to User Management</h1>

    return () => (
      <>
        {header}
        <input
          value={props.modelValue}
          onInput={(e) => {
            const val = (e.target as HTMLInputElement).value
            emit('update:modelValue', val)
          }}
        />
        <p>Username: {props.profile.username}</p>
        <p>Age: {props.profile.age}</p>
        {props.profile.traits.map((trait, index) => (
          <p key={index}>{trait}</p>
        ))}
        <div style="color: red;">
          Default Slot:
          {slots.default?.()}
        </div>
        <div style="color: blue;">
          Extra Slot:
          {slots.extra?.(props.modelValue)}
        </div>
      </>
    )
  }
})

// çˆ¶ç»„ä»¶
export default defineComponent(() => {
  const inputValue = ref('')

  // åˆå§‹åŒ–é»˜è®¤çš„ UserProfile å¯¹è±¡ï¼Œç”¨äºé‡ç½®
  const defaultProfile = new UserProfile()
  defaultProfile.username = 'Mr. Rabbit'
  defaultProfile.age = 10
  defaultProfile.traits = ['Characteristic 1', 'Characteristic 2']

  // åˆå§‹åŒ– userProfile
  const userProfile = reactive(defaultProfile)

  const resetUser = () => {
    inputValue.value = ''
    Object.assign(userProfile, defaultProfile)
  }

  return () => (
    <div>
      <button onClick={resetUser}>Reset User</button>
      <UserDetail
        v-model={inputValue.value}
        profile={userProfile}
        v-slots={{
          extra: (content: string) => <div>Additional Info: {content}</div>
        }}
      >
        <div>This is the default slot content.</div>
      </UserDetail>
      {/* TSX çš„æ’æ§½ä¸¤ç§å†™æ³•ï¼ˆv-slots å’Œ {{}}) */}
      <UserDetail v-model={inputValue.value} profile={userProfile}>
        {{
          default: () => <div>This is the default slot content.</div>,
          extra: (content: string) => <div>Additional Info: {content}</div>
        }}
      </UserDetail>
    </div>
  )
})
```

è¿™ç§æ–¹æ³•å®ç°äº†å‡ ä¹æ‰€æœ‰çš„å•æ–‡ä»¶ç»„ä»¶åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨æ’æ§½ä¸Šæ›´ä¸ºç›´è§‚ã€‚

> å°½ç®¡åœ¨ Vue ä¸­ä½¿ç”¨ JSX æˆ– TSX æ˜¯å¯è¡Œçš„ï¼Œä½†è¿™å¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼šç¼ºä¹æ–‡æ¡£æ”¯æŒã€‚<https://github.com/vuejs/babel-plugin-jsx> ä»…æœ‰ä¸€ç¯‡æ–‡ç« ï¼Œå…·ä½“ç”¨æ³•éœ€è¦æŸ¥çœ‹æºç ç±»å‹å£°æ˜ï¼Œä¾‹å¦‚ç›´æ¥ä¼ é€’ setup çš„ defineComponent å†™æ³•ï¼ˆè¿™ç§å†™æ³•æ— æ³•è¯†åˆ« v-modelï¼Œå› ä¸ºè¿™æ˜¯ ts çš„é—®é¢˜ï¼‰ã€‚

é—®ï¼šdefineComponent æ¨èä½¿ç”¨é€‰é¡¹å¼ + setupï¼Œè¿˜æ˜¯å•çº¯ä¸€ä¸ªå‡½æ•°çš„ setup é£æ ¼ï¼ˆexport defaultï¼Œæ›´æœ‰ç”šè€…å®é™…ä¸Š ()=>()=>jsx å°±èƒ½å£°æ˜ vue ç»„ä»¶ï¼‰ï¼Ÿ

ç­”ï¼šé€‰é¡¹å¼ + setupï¼Œå› ä¸ºåè€…åœ¨åŠŸèƒ½ä¸Šæ²¡æœ‰é—®é¢˜ï¼Œä½†ç±»å‹æç¤ºå¾ˆå·®ã€‚åœ¨æ²¡æœ‰ propsï¼Œemitsï¼Œexposeï¼Œv-model çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åè€…ã€‚

é—®ï¼šä¸ºä»€ä¹ˆ slot æ²¡æœ‰æ ‡æ³¨ç±»å‹ï¼Ÿ

ç­”ï¼šVue æ˜¯ MVVM æ¡†æ¶ï¼Œè€Œ slots ä¸»è¦ç”¨äºè§†å›¾ç»„ç»‡ï¼Œæ²¡å¿…è¦çº ç»“äºè¿™ä¸€ç‚¹ã€‚

é—®ï¼šä¸ºä»€ä¹ˆ emits å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å› trueï¼Œå†æ–­è¨€ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Ÿ

ç­”ï¼šè¿”å› true ä»£è¡¨äº‹ä»¶é€šè¿‡éªŒè¯ï¼Œæ–­è¨€å‡½æ•°ç±»å‹æ˜¯å› ä¸ºæœ‰å‚æ•°ä½†ä¸ä½¿ç”¨æ—¶ä¼šè§¦å‘ eslintï¼ˆunused localï¼‰ï¼Œå¯¼è‡´æ— æ³•ç›´æ¥åˆ©ç”¨ç±»å‹æ¨æ–­ã€‚

é—®ï¼šä¸ºä»€ä¹ˆå¯¹è±¡ props è¦ç”¨ classï¼ˆä¸Šä¾‹ Profileï¼‰ï¼Ÿ

ç­”ï¼šé¦–å…ˆå› ä¸º props å£°æ˜éœ€è¦æ„é€ å™¨ã€‚Vue ä¸ React ä¸åŒï¼Œå®ƒé€šè¿‡ Proxy ç”Ÿæˆä»£ç†ï¼Œè€Œ React è¿½æ±‚ä¸å˜æ€§çš„çº¯å˜æ›´ï¼ˆimmutableï¼‰ã€‚ä½¿ç”¨ class å£°æ˜æ•°æ®ä¸ä»…å¯è¡Œï¼Œè¿˜èƒ½é¿å…è®¸å¤šå“åº”æ€§ä¸¢å¤±é—®é¢˜ã€‚

é—®ï¼šTSX å†™æ³•ä¸­ï¼Œæ‰€æœ‰ ref éƒ½è¦ .value å—ï¼Ÿ

ç­”ï¼šæ˜¯çš„ï¼Œéƒ½éœ€è¦ .valueï¼Œè¿™ä¹Ÿæ˜¯å•æ–‡ä»¶ç»„ä»¶çš„åŠ£åŠ¿ä¹‹ä¸€ï¼šä¾èµ–æ³¨å…¥æˆ–å¤–éƒ¨çš„ ref æ— æ³•è‡ªåŠ¨ .valueï¼Œåœ¨æ²¡æœ‰ ts æç¤ºçš„æƒ…å†µä¸‹å¾ˆéš¾çŸ¥é“æ˜¯å¦éœ€è¦ .valueï¼Œè€Œåœ¨ ts æç¤ºæ­£å¸¸æ—¶ç¼–è¾‘å™¨åˆåŸºæœ¬ä¸å¯ç”¨ã€‚

é—®ï¼šTSX çš„æ’æ§½ä¸¤ç§å†™æ³•ï¼ˆv-slots å’Œ {{}}ï¼‰ä¸­ï¼Œæ¨èå“ªç§ï¼Ÿ

ç­”ï¼šæ— æ‰€è°“ï¼Œä¹ æƒ¯å“ªç§ç”¨å“ªç§ã€‚

é—®ï¼šè¿™ç§ TSX æ˜¯ Vue çš„æœ€ä½³å®è·µå—ï¼Ÿ

ç­”ï¼šç»ä¸æ˜¯ï¼å•æ–‡ä»¶ç»„ä»¶ä¸€ç›´æ˜¯ Vue çš„ç»å¯¹æ ‡å‡†ï¼Œé‡‡ç”¨ TSX ä»…æ˜¯å› ä¸ºå…¶å®é™…å¯ç”¨ï¼Œè€Œç›®å‰å•æ–‡ä»¶ç»„ä»¶ä¸å¯è¡Œã€‚

## å…³äº snippet æç¤º

è¯·å‚è€ƒæœ¬ç«™ VSCode ä¸­çš„ç¬”è®°ï¼Œè‡ªå®šä¹‰ä¸Šè¿°å†™æ³•çš„ snippet æç¤ºã€‚

## ä¸ºä»€ä¹ˆéœ€è¦ç”Ÿå‘½å‘¨æœŸï¼Ÿ

æˆ‘æœ€ä¸èƒ½ç†è§£çš„æ˜¯ç”Ÿå‘½å‘¨æœŸã€‚Solid å®˜ç½‘æ˜ç¡®æŒ‡å‡ºæ— éœ€ç”Ÿå‘½å‘¨æœŸï¼Œä¸ºç®€å•åŠŸèƒ½å¿«é€Ÿå®ç°ä¸æƒ…æ„¿åœ°æä¾›äº†ä¸ª onMountã€‚

![2024-11-29 17:47:41](https://raw.githubusercontent.com/chuenwei0129/my-picgo-repo/master/react/20241129174741.png)

## ä¸ºä»€ä¹ˆ Vue äº‹ä»¶éœ€è¦ emitï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ é€’ propï¼Ÿ

ç­”ï¼šäº‹ä»¶çš„å¤„ç†æ–¹å¼æ›´ç¬¦åˆ HTML çš„é€»è¾‘ã€‚

## watch çš„ä½¿ç”¨è§„èŒƒ

1. å¯¹äºéæœ¬ç»„ä»¶åˆ›å»ºçš„ ref æˆ– reactiveï¼Œwatch å¿…é¡»ä»¥å‡½æ•°è¿”å›çš„å½¢å¼ä½¿ç”¨ã€‚
2. watch ä¸­ä¸åº”è°ƒç”¨å¤–éƒ¨çš„ onUnMount ç­‰ç”Ÿå‘½å‘¨æœŸï¼ˆVue åœ¨ä»»ä½•ä½ç½®éƒ½å¯ä»¥è°ƒç”¨ç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ˜¯ä¸ºäº†ç…§é¡¾æ–°æ‰‹ï¼‰ã€‚

```js
// ç›‘å¬æºæ˜¯ ref/reactive
watch(refOrReactive, (val, pre, onCleanUp)=>{})
// ç›‘å¬å¤šä¸ª
watch([ref1, ref2], ([val1, val2],[pre1,pre2],onCleanUp)=>{})
// ç›‘å¬å…·ä½“å€¼
watch(()=>simpleTypeValue, (val,pre,onCleanUp)=>{})
watch(()=>[value1, value2], ([val1, val2],[pre1,pre2],onCleanUp)=>{})
```

## æœ€å

æœ€è¿‘æˆ‘ç ”ç©¶äº† ant å’Œ naive ui çš„æºç ï¼Œå¾—åˆ°äº†ä¸€äº›æ–°è®¤è¯†ã€‚ç°åœ¨ä¸å†çº ç»“å“ªä¸€ç§æ›´å¥½ï¼Œåªè¦é€‚åˆå›¢é˜Ÿå³å¯ã€‚åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä½¿ç”¨ .tsx æ¥å¼€å‘å…¬å…±ç»„ä»¶ï¼Œä¸šåŠ¡å¼€å‘åˆ™é‡‡ç”¨ .vue + setup + éƒ¨åˆ† tsxã€‚å¯¹äºæ²¡æœ‰çµæ´»åº¦è¦æ±‚çš„ä¸šåŠ¡ï¼Œæˆ‘ç»Ÿä¸€ä½¿ç”¨ templateï¼Œå¹¶å…¨éƒ¨ä¸Š typescriptï¼Œç›®å‰æ„Ÿè§‰æ•ˆæœä¸é”™ã€‚

## æé«˜ç­

- [Vue3 ä¸­ watch ä¸ watchEffect çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ](https://www.zhihu.com/question/462378193/answer/1916657458)
- [computed ä¸ v-model](https://www.bilibili.com/video/BV1H5411z7KJ)
- [å¦‚ä½•ç†è§£ Vue3 é‡Œçš„ EffectScope?](https://www.zhihu.com/question/508610957/answer/2592195517)
