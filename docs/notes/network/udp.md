---
title: TCP/UDP 简述
order: 2
toc: content
group:
  title: 基础知识
---

## 物理层、数据链路层、网络层

> [如果让你来设计网络](https://mp.weixin.qq.com/s?__biz=Mzk0MjE3NDE0Ng==&mid=2247489907&idx=1&sn=a296cb42467cab6f0a7847be32f52dae&chksm=c2c663def5b1eac84b664c8c1cadf1c8ec23ea2e57e48e04add9b833c841256fc9449b62c0ec&scene=178&cur_album_id=1700901576128643073#rd)

在数字通信的世界里，一切从物理层开始，它是网络的基础，负责将电子信号通过硬件 (如网线) 传递。数据链路层接棒，利用交换机等设备管理数据包的流向，确保数据能够在网络中顺畅流动。网络层则扮演着邮差的角色，为数据包贴上目的地标签 (即 IP 地址)，但它不参与实际的传递过程。这些层次共同构成了网络通信的基础架构。

在物理层、数据链路层和网络层的支持下，**任意两个节点都可以通过 IP 地址相连**。**网络层负责定义数据包的目的地，但不传输数据包本身**。

## 引入 TCP / UDP 协议的必要性

> [图解 —— 你管这破玩意儿叫 TCP？](https://mp.weixin.qq.com/s?__biz=Mzk0MjE3NDE0Ng==&mid=2247491962&idx=1&sn=aa4414483edaba487c080e91ad0efb93&chksm=c2c59bd7f5b212c12231394c585f3b063b0b2d5b05d6f05fddccdb4e856875e7ee1127bb30a7&cur_album_id=1700901576128643073&scene=189#wechat_redirect)

虽然基础的网络协议可以将数据包从一个主机传输到另一个主机，但这些数据包最终需要被特定的应用程序或进程所接收。

![20240414165151](https://raw.githubusercontent.com/chuenwei0129/my-picgo-repo/master/me/20240414165151.png)

为了实现这一点，我们引入了端口号的概念，它为每个进程提供了一个唯一的标识符。

![20240414165235](https://raw.githubusercontent.com/chuenwei0129/my-picgo-repo/master/me/20240414165235.png)

在数据包上添加源端口号和目标端口号的头部信息，这样你就将原本主机到主机的通信，升级为了进程和进程之间的通信。这种机制的初步实现形式就是 UDP 协议。

![20240414165415](https://raw.githubusercontent.com/chuenwei0129/my-picgo-repo/master/me/20240414165415.png)

UDP 是一种简单的传输层协议，UDP 不提供复杂的控制机制，利用 IP 提供面向 “无连接” 的通信服务。

![20240414172137](https://raw.githubusercontent.com/chuenwei0129/my-picgo-repo/master/me/20240414172137.png)

- **目标和源端口**：主要是告诉 UDP 协议应该把报文发给哪个进程。
- **包长度**：该字段保存了 UDP 首部的长度跟数据的长度之和。
- **校验和**：校验和是为了提供可靠的 UDP 首部和数据而设计，防止收到在网络传输中受损的 UDP 包。

UDP 不需要在数据传输前建立连接，因此它不保证数据包的顺序或可靠性。数据包可能会丢失或在到达目的地时的顺序与发送时不同。如果需要保障网络数据包的可靠性，那么就需要 TCP 协议来负责。因为 TCP 是一个工作在传输层的可靠数据传输的服务，它能确保接收端接收的网络包是无损坏、无间隔、非冗余和按序的。

## TCP 和 UDP 区别

1. 连接

   - TCP 是面向连接的传输层协议，传输数据前先要建立连接。
   - UDP 是不需要连接，即刻传输数据。

2. 服务对象

   - TCP 是一对一的两点服务，即一条连接只有两个端点。
   - UDP 支持一对一、一对多、多对多的交互通信

3. 可靠性

   - TCP 是可靠交付数据的，数据可以无差错、不丢失、不重复、按序到达。
   - UDP 是尽最大努力交付，不保证可靠交付数据。但是我们可以基于 UDP 传输协议实现一个可靠的传输协议，比如 QUIC 协议，具体可以参见这篇文章：[如何基于 UDP 协议实现可靠传输？](https://xiaolincoding.com/network/3_tcp/quic.html)

4. 拥塞控制、流量控制

   - TCP 有拥塞控制和流量控制机制，保证数据传输的安全性。
   - UDP 则没有，即使网络非常拥堵了，也不会影响 UDP 的发送速率。

5. 首部开销

   - TCP 首部长度较长，会有一定的开销，首部在没有使用 “选项” 字段时是 `20` 个字节，如果使用了 “选项” 字段则会变长的。
   - UDP 首部只有 8 个字节，并且是固定不变的，开销较小。

6. 传输方式

   - TCP 是流式传输，没有边界，但保证顺序和可靠。
   - UDP 是一个包一个包的发送，是有边界的，但可能会丢包和乱序。

7. 分片不同

   - TCP 的数据大小如果大于 MSS 大小，则会在传输层进行分片，目标主机收到后，也同样在传输层组装 TCP 数据包，如果中途丢失了一个分片，只需要传输丢失的这个分片。
   - UDP 的数据大小如果大于 MTU 大小，则会在 IP 层进行分片，目标主机收到后，在 IP 层组装完数据，接着再传给传输层。
