# å‰ç«¯å·¥ç¨‹åŒ–ï¼šå‰ç½®çŸ¥è¯†<!-- omit in toc -->

## Node ç‰ˆæœ¬ç®¡ç†ï¼šnvm

### windows

#### nvm-windows å®‰è£…

ä¸‹è½½ [nvm-windows](https://github.com/coreybutler/nvm-windows/releases)ï¼Œä¸‹è½½å®Œæˆï¼Œè§£å‹æ–‡ä»¶ä¹‹åï¼ŒåŒå‡»è¿›è¡Œå®‰è£…å³å¯ã€‚

å®‰è£…å®Œæˆï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š`nvm v`ï¼ŒæŸ¥çœ‹åˆ°å¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œè¯´æ˜ nvm å®‰è£…æˆåŠŸäº†ã€‚

#### å¸¸ç”¨å‘½ä»¤

|         å‘½ä»¤          |                            åŠŸèƒ½                            |
| :-------------------: | :--------------------------------------------------------: |
|  nvm list available   | åˆ—å‡ºæ‰€æœ‰è¿œç¨‹æœåŠ¡å™¨çš„ nodejs ç‰ˆæœ¬ï¼ˆå®˜æ–¹ node version listï¼‰ |
|  nvm install latest   |                   å®‰è£…æœ€æ–°çš„ nodejs ç‰ˆæœ¬                   |
|  nvm install 12.18.1  |                   å®‰è£…å¯¹åº”çš„ nodejs ç‰ˆæœ¬                   |
|    nvm use 12.18.1    |                   ä½¿ç”¨å¯¹åº”çš„ nodejs ç‰ˆæœ¬                   |
| nvm uninstall 12.18.1 |                   å¸è½½å¯¹åº”çš„ nodejs ç‰ˆæœ¬                   |
|       nvm list        |                 åˆ—å‡ºå·²ç»å®‰è£…çš„ nodejs ç‰ˆæœ¬                 |

æ›´å¤šå‘½ä»¤åœ¨å‘½ä»¤è¡Œè¾“å…¥ `nvm` å³å¯æŸ¥çœ‹ã€‚

#### ä½¿ç”¨æ·˜å®é•œåƒ

åœ¨ nvm å®‰è£…ç›®å½•ä¸‹æ‰¾åˆ° `settings.txt` æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢ä¸¤è¡Œä»£ç ï¼š

```sh
node_mirror: https://npm.taobao.org/mirrors/node/
npm_mirror: https://npm.taobao.org/mirrors/npm/
```

æˆ–è€…åœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š

```sh
nvm node_mirror https://npm.taobao.org/mirrors/node/  # é»˜è®¤åœ°å€ï¼šhttps://nodejs.org/dist/.
nvm npm_mirror https://npm.taobao.org/mirrors/npm/  # é»˜è®¤åœ°å€ï¼šhttps://github.com/npm/cli/archive/.
```

#### windows ä¸‹ npm å…¨å±€åŒ…è®¾ç½®

**è§£å†³ nvm åˆ‡æ¢ç‰ˆæœ¬åï¼Œå…¨å±€å®‰è£…çš„åŒ…ï¼Œéœ€è¦é‡æ–°å®‰è£…ä¸€éçš„é—®é¢˜**ï¼Œå¦‚ä¸‹ï¼š

1. è®¾ç½® npm å…¨å±€åŒ…çš„å®‰è£…è·¯å¾„ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š`npm config set prefix å…¨å±€åŒ…å®‰è£…è·¯å¾„`
2. é…ç½®ç¯å¢ƒå˜é‡ï¼šå˜é‡åä¸ºï¼š`NPM_HOME`ï¼Œå˜é‡å€¼ä¸ºï¼š**å…¨å±€åŒ…å®‰è£…è·¯å¾„**
3. åœ¨ path ä¸­ï¼Œåœ¨ `%NVM_SYMLINK%` ä¹‹å‰ï¼Œæ·»åŠ  `%NPM_HOME%`

#### nrm ç®¡ç† npm é•œåƒ

**å…¨å±€å®‰è£… nrmï¼š**

```sh
npm install nrm -g
```

å®‰è£…å®Œæˆåï¼Œè¾“å…¥å‘½ä»¤ `nrm ls`ï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤çš„ 6 ä¸ªæºï¼ˆå¸¦ `*` å·çš„ä¸ºå½“å‰ä½¿ç”¨çš„æºï¼‰

```sh
* npm ---- https://registry.npmjs.org/
  cnpm --- http://r.cnpmjs.org/
  taobao - https://registry.npm.taobao.org/
  nj ----- https://registry.nodejitsu.com/
  npmMirror  https://skimdb.npmjs.com/registry/
  edunpm - http://registry.enpmjs.org/
```

è¾“å…¥ `nrm use taobao`ï¼Œå³åˆ‡æ¢ registry åˆ° taobaoï¼Œå³å¯ä½¿ç”¨æ·˜å®çš„æºè¿›è¡Œä¸‹è½½äº†ã€‚

**nrm å¸¸ç”¨å‘½ä»¤ï¼š**

|              å‘½ä»¤               |                     åŠŸèƒ½                      |
| :-----------------------------: | :-------------------------------------------: |
|             nrm ls              |        æŸ¥çœ‹æ‰€æœ‰é…ç½®å¥½çš„æºä»¥åŠå¯¹åº”åç§°         |
| nrm add xxx <http://npm.xxx.cn> | æ·»åŠ æºï¼Œxxx æ˜¯è‡ªå®šä¹‰åç§°ï¼Œåé¢æ˜¯æºçš„ url åœ°å€ |
|           nrm del xxx           |                 åˆ é™¤å¯¹åº”çš„æº                  |
|          nrm test xxx           |   æµ‹è¯•æºçš„é€Ÿåº¦ï¼Œä¸åŠ åç§°ï¼Œæµ‹è¯•æ‰€æœ‰æºçš„é€Ÿåº¦    |
|           nrm use xxx           |         åˆ‡æ¢æºï¼Œå³å¯ä½¿ç”¨å¯¹åº”åç§°çš„æº          |

æ›´å¤šå‘½ä»¤åœ¨å‘½ä»¤è¡Œè¾“å…¥ `nrm` å³å¯æŸ¥çœ‹ã€‚

### MacOS

#### ç¬¬ä¸€æ­¥ï¼šå®‰è£…

**homebrew å®‰è£…ï¼š**

```sh
brew install nvm
```

**[è„šæœ¬ç›´æ¥å®‰è£…](https://github.com/nvm-sh/nvm)ï¼š**

```sh
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.2/install.sh | bash
```

#### ç¬¬äºŒæ­¥ï¼šè®¾ç½® nvm çš„ç¯å¢ƒå˜é‡

å®‰è£…å¥½ nvm åï¼Œéœ€è¦å°†ç¯å¢ƒå˜é‡å†™å…¥æˆ‘ä»¬çš„ shell é…ç½®æ–‡ä»¶ä¸­ã€‚

å°†ä»¥ä¸‹ç¯å¢ƒå˜é‡è„šæœ¬ copy è¿› shell é…ç½®æ–‡ä»¶ä¸­ï¼š`vim ~/.zshrc`

```sh
export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" # This loads nvm
```

è‡³æ­¤ nvm å·²ç»å®‰è£…å¥½ï¼Œå¯ä»¥å°è¯•åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ `nvm`ï¼Œä½ å¯ä»¥çœ‹åˆ° nvm å·²ç»æ­£å¸¸å·¥ä½œäº†ã€‚

#### MacOS ä¸‹ å¸¸ç”¨ nvm å‘½ä»¤

- **`nvm ls-remote`ï¼š** åˆ—å‡ºæ‰€æœ‰å¯å®‰è£…çš„ç‰ˆæœ¬ã€‚

- **`nvm install <version>`ï¼š** å®‰è£…æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ `nvm install v8.14.0`ã€‚

- **`nvm uninstall <version>`ï¼š** å¸è½½æŒ‡å®šçš„ç‰ˆæœ¬ã€‚

- **`nvm ls`ï¼š** åˆ—å‡ºæ‰€æœ‰å·²ç»å®‰è£…çš„ç‰ˆæœ¬ã€‚

- **`nvm use <version>`ï¼š** åˆ‡æ¢ä½¿ç”¨æŒ‡å®šçš„ç‰ˆæœ¬ã€‚

- **`nvm current`ï¼š** æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚

- **`nvm alias default <version>`ï¼š** è®¾ç½®é»˜è®¤ node ç‰ˆæœ¬ã€‚

- **`nvm run 4.2.2 --version`ï¼š** åœ¨å½“å‰ç»ˆç«¯çš„å­è¿›ç¨‹ä¸­è¿è¡Œç‰¹å®šç‰ˆæœ¬çš„ nodeã€‚

- **`nvm deactivate`ï¼š** è§£é™¤å½“å‰ç‰ˆæœ¬ç»‘å®šï¼š

  > nvm é»˜è®¤æ˜¯ä¸èƒ½åˆ é™¤è¢«è®¾å®šä¸º default ç‰ˆæœ¬çš„ nodeï¼Œç‰¹åˆ«æ˜¯åªå®‰è£…äº†ä¸€ä¸ª node çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å…ˆè§£é™¤å½“å‰ç‰ˆæœ¬ç»‘å®šï¼Œç„¶åå†ä½¿ç”¨ `nvm uninstall <version>` åˆ é™¤ã€‚

#### M1 èŠ¯ç‰‡ Mac ç®¡ç† `v14` åŠä»¥ä¸‹çš„è€ç‰ˆæœ¬ Node

**ä½ç‰ˆæœ¬çš„ Node å¹¶ä¸æ˜¯åŸºäº `arm64` æ¶æ„çš„ï¼Œä¸é€‚é… `M1` èŠ¯ç‰‡**ã€‚

åœ¨ç»ˆç«¯ä¸­ï¼Œè¾“å…¥ï¼š

```sh
arch -x86_64 zsh
```

é€šè¿‡è¿™ä¸ªå‘½ä»¤å¯ä»¥è®© shell è¿è¡Œåœ¨ Rosetta2 ä¸‹ã€‚

ä¹‹åå¯ä»¥é€šè¿‡ `nvm install v12` æ¥å®‰è£…ä½ç‰ˆæœ¬ Nodeã€‚

> åœ¨æ­¤ä¹‹åï¼Œå¯ä»¥ä¸ç”¨åœ¨ Rosetta2 ä¸­å°±å¯ä»¥ä½¿ç”¨å®‰è£…çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥å°† `Node v15` ä¸å…¶ä»–èŠ‚ç‚¹ç‰ˆæœ¬äº’æ¢ä½¿ç”¨ã€‚

#### Node è¢«å®‰è£…åœ¨å“ªé‡Œï¼Ÿ

åœ¨ç»ˆç«¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `which node` æ¥æŸ¥çœ‹æˆ‘ä»¬çš„ Node è¢«å®‰è£…åˆ°äº†å“ªé‡Œï¼Œè¿™é‡Œç»ˆç«¯æ‰“å°å‡ºæ¥çš„åœ°å€å…¶å®æ˜¯ä½ å½“å‰ä½¿ç”¨çš„ Node ç‰ˆæœ¬å¿«æ·æ–¹å¼çš„åœ°å€ã€‚

```sh
/Users/ä½ çš„ç”¨æˆ·å/.nvm/versions/node/v10.13.0/bin/node
```

å¦‚æœä½ æƒ³æŸ¥çœ‹æ‰€æœ‰ Node ç‰ˆæœ¬çš„å®‰è£…æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨**è®¿è¾¾**ä¸­ä½¿ç”¨å¿«æ·é”® `Command+Shift+G` è¾“å…¥ **`/Users/ä½ çš„ç”¨æˆ·å/.nvm/versions`** åœ°å€å°±å¯ä»¥çœ‹åˆ°ã€‚

> **.nvm** æ˜¯ä¸ªéšè—æ–‡ä»¶å¤¹åœ¨**è®¿è¾¾**ä¸­é»˜è®¤æ˜¯ä¸æ˜¾ç¤ºéšè—æ–‡ä»¶å¤¹ï¼Œæ˜¾ç¤ºéšè—æ–‡ä»¶çš„å¿«æ·é”®æ˜¯ `Command+Shift+.`ï¼Œå…³é—­ä¹Ÿæ˜¯è¿™ä¸ªå¿«æ·é”®ã€‚

#### MacOSï¼šåœ¨å¤šç¯å¢ƒä¸­ï¼Œnpm è¯¥å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ

æ¯ä¸ªç‰ˆæœ¬çš„ Node éƒ½ä¼šè‡ªå¸¦ä¸€ä¸ªä¸åŒç‰ˆæœ¬çš„ npmï¼Œå¯ä»¥ç”¨ `npm -v` æ¥æŸ¥çœ‹ npm çš„ç‰ˆæœ¬ã€‚å…¨å±€å®‰è£…çš„ npm åŒ…å¹¶ä¸ä¼šåœ¨ä¸åŒçš„ `Node` ç¯å¢ƒä¸­å…±äº«ï¼Œå› ä¸ºè¿™ä¼šå¼•èµ·å…¼å®¹é—®é¢˜ã€‚

å®ƒä»¬è¢«æ”¾åœ¨äº†ä¸åŒç‰ˆæœ¬çš„ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ **`~/.nvm/versions/node/<version>/lib/node_modules</version>`** è¿™æ ·çš„ç›®å½•ã€‚è¿™åˆšå¥½ä¹Ÿçœå»æˆ‘ä»¬åœ¨ Linux ä¸­ä½¿ç”¨ `sudo` çš„åŠŸå¤«äº†ã€‚å› ä¸ºè¿™æ˜¯ç”¨æˆ·çš„ä¸»æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸ä¼šå¼•èµ·æƒé™é—®é¢˜ã€‚

ä½†é—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬å®‰è£…è¿‡çš„ `npm` åŒ…ï¼Œéƒ½è¦é‡æ–°å†è£…ä¸€æ¬¡ï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬æœ‰ä¸ªåŠæ³•æ¥è§£å†³æˆ‘ä»¬çš„é—®é¢˜ï¼Œè¿è¡Œä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥ä»ç‰¹å®šç‰ˆæœ¬å¯¼å…¥åˆ°æˆ‘ä»¬å°†è¦å®‰è£…çš„æ–°ç‰ˆæœ¬ Nodeï¼š

```sh
nvm install v5.0.0 --reinstall-packages-from=4.2
```

## åŒ…ç®¡ç†ï¼šnpm

### åŸºç¡€å‘½ä»¤

- **æŸ¥çœ‹ `npm` çš„ç‰ˆæœ¬**ï¼š `npm -v`
- **æŸ¥çœ‹å„ä¸ªå‘½ä»¤çš„ç®€å•ç”¨æ³•**ï¼š `npm -l`
- **æŸ¥çœ‹ `npm` å‘½ä»¤åˆ—è¡¨**ï¼š `npm help`
- **æŸ¥çœ‹ `npm` çš„é…ç½®**ï¼š `npm config list -l`

### npm init åˆ›å»ºæ¨¡å—

å°¾ç¼€å¸¦ `-f`ï¼ˆä»£è¡¨ forceï¼‰ã€`-y`ï¼ˆä»£è¡¨ yesï¼‰

### npm set è®¾ç½®ç¯å¢ƒå˜é‡

```sh
npm set init-author-name 'my name jerry'
npm set init-author-email '12345@qq.com'
npm set init-author-url 'http://yourdomain.com'
npm set init-license 'MIT'

# è®¾ç½®ä»£ç†
npm config set proxy http://server:port
npm config set https-proxy http://server:port

# åˆ é™¤ä»£ç†
npm config delete proxy
npm config delete https-proxy
```

æ‰§è¡Œäº†ä»¥ä¸Šçš„ä¿®æ”¹ï¼Œæ­¤æ—¶ Package.json å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–

```sh
# è®¾ç½®åæ‰§è¡Œ init æ‰æ˜¯çœŸæ­£ä¿®æ”¹æˆåŠŸ
npm init
```

### npm search æœç´¢æ¨¡å—

```sh
npm search <æœç´¢è¯> [-g]
```

`npm search` å‘½ä»¤ç”¨äºæœç´¢ npm ä»“åº“ï¼Œå®ƒåé¢å¯ä»¥è·Ÿå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥è·Ÿæ­£åˆ™è¡¨è¾¾å¼ã€‚

### npm list æŸ¥çœ‹æ¨¡å—

```sh
# å½“å‰é¡¹ç›®å®‰è£…çš„æ‰€æœ‰æ¨¡å—
npm list

# åˆ—å‡ºå…¨å±€å®‰è£…çš„æ¨¡å— å¸¦ä¸Š[--depth=0] ä¸æ·±å…¥åˆ°åŒ…çš„æ”¯ç‚¹ æ›´ç®€æ´
npm list -g --depth=0

# åˆ—å‡ºéœ€è¦å‡çº§çš„å…¨å±€åŒ… åŒ…æ‹¬ npm è‡ªå·±
npm outdated -g
```

### npm install å®‰è£…æ¨¡å—

```sh
# è¯»å– package.json é‡Œé¢çš„é…ç½®å•å®‰è£…
npm install
# å¯ç®€å†™æˆ npm i

# é»˜è®¤å®‰è£…æŒ‡å®šæ¨¡å—çš„æœ€æ–°(@latest)ç‰ˆæœ¬
npm install [<@scope>/]<name>
# eg: npm install gulp

# å®‰è£…æŒ‡å®šæ¨¡å—çš„æŒ‡å®šç‰ˆæœ¬
npm install [<@scope>/]<name>@<version>
# eg: npm install gulp@3.9.1

# å®‰è£…æŒ‡å®šæŒ‡å®šç‰ˆæœ¬èŒƒå›´å†…çš„æ¨¡å—
npm install [<@scope>/]<name>@<version range>
# eg: npm install vue@">=1.0.28 < 2.0.0"

# å®‰è£…æŒ‡å®šæ¨¡å—çš„æŒ‡å®šæ ‡ç­¾ é»˜è®¤å€¼ä¸º(@latest)
npm install [<@scope>/]<name>@<tag>
# eg: npm install sax@0.1.1

# é€šè¿‡ Github ä»£ç åº“åœ°å€å®‰è£…
npm install <tarball url>
# eg: npm install git://github.com/package/path.git
```

### npm uninstall å¸è½½æ¨¡å—

```sh
# å¸è½½å½“å‰é¡¹ç›®æˆ–å…¨å±€æ¨¡å—
npm uninstall <name> [-g]
# eg: npm uninstall gulp --save-dev
```

å¸è½½åï¼Œä½ å¯ä»¥åˆ° **`/node_modules/`** ç›®å½•ä¸‹æŸ¥çœ‹åŒ…æ˜¯å¦è¿˜å­˜åœ¨

### npm update æ›´æ–°æ¨¡å—

```sh
# å‡çº§å½“å‰é¡¹ç›®æˆ–å…¨å±€çš„æŒ‡å®šæ¨¡å—
npm update <name> [-g]
# eg: npm update express
```

### npm run æ‰§è¡Œè„šæœ¬

Package.json çš„ `scripts` å­—æ®µï¼Œå¯ä»¥ç”¨äºæŒ‡å®šè„šæœ¬å‘½ä»¤ï¼Œä¾› npm ç›´æ¥è°ƒç”¨ã€‚`npm run` ä¼šåˆ›å»ºä¸€ä¸ª Shellï¼Œæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚

1. **ä¸¤ä¸ªå‘½ä»¤ç®€å†™**ï¼š**`start` å’Œ `test` å±äºç‰¹æ®Šå‘½ä»¤ï¼Œå¯ä»¥çœç•¥ `run`ï¼Œå…¶ä½™çš„éƒ½å¾—å¸¦ä¸Š `run`ã€‚**

2. **å¯é…ç½®å‚æ•°**ï¼šæ ¼å¼æ˜¯åŠ ä¸Šä¸¤ä¸ªè¿è¯çº¿ï¼ˆ--ï¼‰

3. **å†…éƒ¨å˜é‡ï¼š**

    ```js
    {
      "name": "npm_test",
      "version": "1.0.0",
      "config": {
        "reporter": "xunit"
      },
      "script":{
        "bundle": "mkdir -p build/$npm_package_version/",
        // $npm_package_version è¯»çš„æ˜¯å¤–å±‚ "version" çš„å€¼ï¼ŒåŒç† $npm_package_name è¯»çš„æ˜¯å¤–å±‚ "name" çš„å€¼
        "test": "mocha test/ --reporter $npm_package_config_reporter"
        // $npm_package_config_reporter è¯»çš„æ˜¯ "config" é‡Œçš„ "reporter"
      }
    }
    ```

4. **`pre-` å’Œ `post-` ä¸¤ä¸ªé’©å­ï¼š**

```sh
# å› ä¸ºæœ‰å®šä¹‰äº†ä¸¤ä¸ªé’©å­ pretestã€posttest
npm run test
# æ‰€ä»¥å…ˆæ‰§è¡Œ npm run pretest
# ç„¶åæ‰§è¡Œ npm run test
# æœ€åæ‰§è¡Œ npm run posttest
```

### npm publish å‘å¸ƒæ¨¡å—

```sh
# æœªæ³¨å†Œ ç”³è¯·æ³¨å†Œä¸€ä¸ªç”¨æˆ· ç›´æ¥åœ¨ https://www.npmjs.com/ æ³¨å†Œä¸€æ ·
npm adduser
# æ‰§è¡Œå å¡«å†™å‡ ä¸ªé—®é¢˜ Usernameã€Passwordã€Email

#å·²æ³¨å†Œ
npm login

#å‘å¸ƒ
npm publish
```

### npm-link

ä½¿ç”¨ `npm link` èƒ½å¤Ÿé¿å…é‡å¤ä¸”ç¹ççš„æ‰“åŒ…å‘å¸ƒæ“ä½œï¼Œç»™å¼€å‘è°ƒè¯•å¸¦æ¥ä¾¿æ·ï¼Œè€Œä¸”ä½¿ç”¨æ–¹æ³•ç®€å•ã€‚

å‡è®¾ä½ ç»´æŠ¤çš„ä¸‹æ¸¸ä¸šåŠ¡é¡¹ç›®å«åš appï¼Œä¸Šæ¸¸çš„ä¾èµ–å«åš depï¼Œé‚£ä¹ˆè¦æƒ³åšåˆ° **ã€Œdep ä¸€æ”¹åŠ¨ï¼Œapp å°±èƒ½åŒæ­¥æ›´æ–°ã€**ï¼Œåªéœ€è¦è¿™æ ·ï¼š

```sh
# 1. åœ¨ dep æ‰€åœ¨è·¯å¾„æ‰§è¡Œ
npm link

# 2. åœ¨ app æ‰€åœ¨è·¯å¾„æ‰§è¡Œ
npm link dep
```

è¿™æ ·å°±å½¢æˆäº† app ä¸ dep ä¹‹é—´åŸºæœ¬çš„ã€Œé“¾æ¥ã€å…³ç³»ã€‚åªè¦è¿›å…¥ app çš„ `node_modules` æŸ¥çœ‹ä¸€ä¸‹ï¼Œä¸éš¾å‘ç° npm å…¶å®å°±æ˜¯æ›¿ä½ å»ºç«‹äº†ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„ã€Œå¿«æ·æ–¹å¼ã€ï¼ˆè½¯é“¾æ¥ï¼‰è·³åˆ° dep ä¸‹è€Œå·²ã€‚

åœ¨å­˜åœ¨å¤šä¸ªäº’ç›¸ä¾èµ–çš„åŒ…çš„æ—¶å€™ï¼Œæ‰‹åŠ¨ç»´æŠ¤è¿™ä¸ªé“¾æ¥å…³ç³»éå¸¸éº»çƒ¦è€Œä¸”å®¹æ˜“å‡ºé”™ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥ç”¨ç¤¾åŒºçš„ `yarn workspace` æˆ– Lerna æ¥è‡ªåŠ¨å¸®ä½ ç®¡ç†è¿™äº›åŒ…ã€‚

**è§£é™¤é“¾æ¥ï¼š**

```sh
# 1. åœ¨ dep æ‰€åœ¨è·¯å¾„æ‰§è¡Œï¼Œè¿™æ ·æœ¬åœ°çš„ dep åŒ…æ¨¡å—å°±è§£é™¤äº†ï¼Œå…¶ä»–é¡¹ç›®çš„è½¯è¿æ¥ä¹Ÿå¤±æ•ˆäº†ã€‚
npm unlink dep

# 2. åœ¨ app æ‰€åœ¨è·¯å¾„æ‰§è¡Œï¼Œè¿™æ · app é‡Œå°±è§£é™¤äº† dep æ¨¡å—çš„è½¯è¿æ¥
npm unlink dep
```

### npm ç½‘ç»œé—®é¢˜

#### npm é•œåƒ

- **åŸé•œåƒ**ï¼š<https://registry.npmjs.org/>
- **æ·˜å®é•œåƒ**ï¼š<https://registry.npm.taobao.org/>

#### é•œåƒè®¾ç½®

```js
npm config set registry https://registry.npm.taobao.org/
```

æ‰‹åŠ¨è®¾ç½®ä¸å¤Ÿçµæ´»æ¨èä½¿ç”¨ npm é•œåƒç®¡ç†å·¥å…· nrm

#### node-gyp

æœ‰äº† nrm åˆ‡æ¢åˆ°æ·˜å®é•œåƒä¸Šï¼Œå®‰è£…é€Ÿåº¦ä¼šæ˜æ˜¾åŠ å¿«ï¼Œä½†æ˜¯é‡ä¸Šå®‰è£…çš„æ¨¡å—**ä¾èµ–äº† C++ æ¨¡å—**é‚£å°±å‘çˆ¹äº†ã€‚åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä¼šéšå¼å®‰è£… node-gypï¼Œnode-gyp å¯ç¼–è¯‘è¿™äº›ä¾èµ– C++ æ¨¡å—çš„æ¨¡å—ã€‚

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œnode-gyp åœ¨é¦–æ¬¡ç¼–è¯‘æ—¶ä¼šä¾èµ– Node æºç ï¼Œæ‰€ä»¥åˆæ‚„æ‚„å»ä¸‹è½½ Nodeã€‚**è™½ç„¶åœ¨å‰é¢å·²è®¾ç½®äº†æ·˜å®é•œåƒï¼Œä½†æ˜¯åœ¨è¿™é‡Œä¸€ç‚¹åµç”¨éƒ½æ²¡æœ‰**ã€‚è¿™æ ·åˆå› ä¸ºå›½å†…ç½‘ç»œç¯å¢ƒçš„åŸå› ï¼Œå†æ¬¡é‡ä¸Šå®‰è£…è¿‡æ…¢æˆ–å®‰è£…å¤±è´¥çš„æƒ…å†µã€‚

è¿˜å¥½ `npm config` æä¾›äº†ä¸€ä¸ªå‚æ•° `disturl`ï¼Œå®ƒå¯è®¾ç½® Node é•œåƒåœ°å€ï¼Œå½“ç„¶è¿˜æ˜¯å°†å…¶æŒ‡å‘å›½å†…çš„æ·˜å®é•œåƒã€‚è¿™æ ·åˆèƒ½çˆ½æ­ªæ­ªå®‰è£…è¿™äº›ä¾èµ– C++ æ¨¡å—çš„æ¨¡å—äº†ã€‚

```js
npm config set disturl https://npm.taobao.org/mirrors/node/
```

#### node-sass

> dart-sass æ¯” node-sass æ›´é¦™

å®‰è£… node-sass æ—¶ï¼Œåœ¨ install é˜¶æ®µä¼šä» Github ä¸Šä¸‹è½½ä¸€ä¸ªå« binding.node çš„æ–‡ä»¶ï¼Œè€Œ GitHub Releases é‡Œçš„æ–‡ä»¶éƒ½æ‰˜ç®¡åœ¨ **s3.amazonaws.com** ä¸Šï¼Œè¿™ä¸ªç½‘å€è¢« **Q** äº†ï¼Œæ‰€ä»¥å®‰è£…ä¸äº†ã€‚

ç„¶è€ŒåŠæ³•æ€»æ¯”å›°éš¾å¤šï¼Œä» node-sass çš„å®˜æ–¹æ–‡æ¡£ä¸­å¯æ‰¾åˆ°ä¸€ä¸ªå« `sass_binary_site` çš„å‚æ•°ï¼Œå®ƒå¯è®¾ç½® sass é•œåƒåœ°å€ï¼Œæ¯«æ— ç–‘é—®è¿˜æ˜¯å°†å…¶æŒ‡å‘å›½å†…çš„æ·˜å®é•œåƒã€‚è¿™æ ·åˆèƒ½çˆ½æ­ªæ­ªå®‰è£… node-sass äº†ã€‚

```js
npm config set sass_binary_site https://npm.taobao.org/mirrors/node-sass/
```

å…¶å®è¿˜æœ‰å¥½å‡ ä¸ªç±»ä¼¼çš„æ¨¡å—ï¼Œç»Ÿä¸€è®¾ç½®æ–¹ä¾¿å®‰è£…ã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„å‡ ä¸ªæ¨¡å—é•œåƒåœ°å€é…ç½®ï¼Œè¯·æ”¶ä¸‹ï¼

åˆ†åˆ«æ˜¯ï¼š`Sass`ã€`Sharp`ã€`Electron`ã€`Puppeteer`ã€`Phantom`ã€`Sentry`ã€`Sqlite`ã€`Python`ã€‚

**é•œåƒåœ°å€é…ç½®ï¼š**

```sh
# npm config set <name> <url> ä¸€é”®å¤åˆ¶ï¼Œæ°¸ä¹…ä½¿ç”¨ã€‚ç‰¹åˆ«æ³¨æ„ï¼Œåˆ«æ¼äº†æœ€åé¢çš„ / ,å¸¦ / çš„è¯æ‰èƒ½æ‹¼æˆä¸€ä¸ªå®Œæ•´çš„é•œåƒè·¯å¾„ï¼Œå¦åˆ™å¯èƒ½æ‹¼æ¥è·¯å¾„å¤±è´¥
npm config set sass_binary_site https://npm.taobao.org/mirrors/node-sass/
npm config set sharp_dist_base_url https://npm.taobao.org/mirrors/sharp-libvips/
npm config set electron_mirror https://npm.taobao.org/mirrors/electron/
npm config set puppeteer_download_host https://npm.taobao.org/mirrors/
npm config set phantomjs_cdnurl https://npm.taobao.org/mirrors/phantomjs/
npm config set sentrycli_cdnurl https://npm.taobao.org/mirrors/sentry-cli/
npm config set sqlite3_binary_site https://npm.taobao.org/mirrors/sqlite3/
npm config set python_mirror https://npm.taobao.org/mirrors/python/
```

å¦‚æœæœ‰æ¡ä»¶ï¼Œå»ºè®®æŠŠè¿™äº›é•œåƒæ–‡ä»¶æ¬åˆ°è‡ªå·±æˆ–å…¬å¸çš„æœåŠ¡å™¨ä¸Šï¼Œå°†é•œåƒåœ°å€æŒ‡å‘è‡ªå·±çš„æœåŠ¡å™¨å³å¯ã€‚åœ¨å…¬å¸å†…ç½‘æ­å»ºä¸€ä¸ªè¿™æ ·çš„é•œåƒæœåŠ¡å™¨ï¼Œä¸€ç›´å®‰è£…ä¸€ç›´çˆ½ã€‚

```sh
npm config set electron_mirror https://yyyxxx/mirrors/electron/
```

**æºç åˆ†æï¼š**

ä»¥ç»å¸¸å¡ä½çš„ node-sass ä¸ºä¾‹ï¼Œä¸‹é¢æ˜¯å‘çˆ¹è´§ **`node-sass/lib/extensions.js`** çš„æºç éƒ¨åˆ†ï¼Œå¯çœ‹å‡ºå®ƒä¼šé»˜è®¤èµ° GitHub Releases çš„æ‰˜ç®¡åœ°å€ï¼Œä¸Šé¢ä¹Ÿåˆ†æè¿‡åŸå› ï¼Œåœ¨è¿™é‡Œå°±ä¸é‡å¤äº†ã€‚

```js
function getBinaryUrl() {
  const site =
    getArgument('--sass-binary-site') ||
    process.env.SASS_BINARY_SITE ||
    process.env.npm_config_sass_binary_site ||
    (pkg.nodeSassConfig && pkg.nodeSassConfig.binarySite) ||
    'https://github.com/sass/node-sass/releases/download'
  const result = [site, 'v' + pkg.version, getBinaryName()].join('/')
  return result
}
```

#### Node ç‰ˆæœ¬ä¸ node-sass ç‰ˆæœ¬ä¸å…¼å®¹

node-sass ç‰ˆæœ¬å…¼å®¹æ€§å¥½å·®ï¼Œå¿…é¡»ä¸ Node ç‰ˆæœ¬å¯¹åº”ä½¿ç”¨æ‰è¡Œï¼Œè¯¦æƒ…è¯·å‚è€ƒ `node-sass-version-association`ï¼Œå¤ç”¨å®˜æ–¹æ–‡æ¡£çš„ç‰ˆæœ¬å¯¹ç…§è¡¨ï¼Œå¦‚ä¸‹ã€‚

| NodeJS  | Minimum node-sass version | Node Module |
| :-----: | :-----------------------: | :---------: |
| Node 14 |           4.14+           |     83      |
| Node 13 |           4.13+           |     79      |
| Node 12 |           4.12+           |     72      |
| Node 11 |           4.10+           |     67      |
| Node 10 |           4.9+            |     64      |
| Node 8  |          4.5.3+           |     57      |

å‡å¦‚æœ¬åœ°ä½¿ç”¨ nvm æˆ– n è¿›è¡Œ Node ç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”å·²åˆ‡æ¢äº† Node ç‰ˆæœ¬ï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç° **`Windows/OS X/Linux 64-bit with Node.js 12.x`** è¿™æ ·çš„æç¤º

è¿™æ˜¯å› ä¸º node-sass ç‰ˆæœ¬å’Œ Node ç‰ˆæœ¬æ˜¯å…³è”çš„(çœ‹ä¸Šé¢çš„è¡¨æ ¼)ï¼Œä¿®æ”¹ Node ç‰ˆæœ¬ååœ¨å…¨å±€ç¼“å­˜ä¸­åŒ¹é…ä¸åˆ°å¯¹åº”çš„ **`binding.node`** æ–‡ä»¶è€Œå¯¼è‡´å®‰è£…å¤±è´¥ã€‚æ ¹æ®é”™è¯¯æç¤ºï¼Œæ¸…ç† npm ç¼“å­˜ä¸”é‡æ–°å®‰è£…å³å¯ï¼Œè§£å†³åŠæ³•å¦‚ä¸‹ã€‚

```sh
npm cache clean -f
npm rebuild node-sass
```

#### npm å®‰è£…å¤±è´¥åé‡æ–°å®‰è£…

æœ‰å¯èƒ½æ— æƒé™åˆ é™¤å·²å®‰è£…çš„å†…å®¹ï¼Œå¯¼è‡´é‡æ–°å®‰è£…æ—¶å¯èƒ½ä¼šäº§ç”ŸæŸäº›é—®é¢˜ï¼Œå»ºè®®å°† node_modules å…¨éƒ¨åˆ é™¤å¹¶é‡æ–°å®‰è£…ã€‚

æ¨èä½¿ç”¨ `rimraf` åˆ é™¤ node_modulesï¼Œä¸€ä¸ª Node ç‰ˆçš„ `rm -rf` å·¥å…·ã€‚

```sh
npm i -g rimraf
```

åœ¨é¡¹ç›®çš„ `package.json` ä¸­åŠ å…¥ `npm scripts` è®© `rimraf` å¸¸é©»ã€‚ä¸‰å¤§æ“ä½œç³»ç»Ÿé€šç”¨ï¼Œéå¸¸æ¨èä½¿ç”¨ã€‚

```js
{
  "scripts": {
    "reinstall": "rimraf node_modules && npm i"
  }
}
```

#### æ€»ç»“

**npm** é•œåƒé—®é¢˜çš„å‘ç¡®å®å¾ˆå¤šï¼Œå½’æ ¹åˆ°åº•è¿˜æ˜¯ç½‘ç»œç¯å¢ƒå¯¼è‡´çš„ã€‚å½“ç„¶è¿™äº›é—®é¢˜ä¹Ÿé˜»ç¢ä¸äº†ä¹äºæ¢ç´¢çš„æˆ‘ä»¬ï¼ŒåŠæ³•æ€»æ¯”å›°éš¾å¤šï¼ŒåšæŒä¸‹å»å§‹ç»ˆèƒ½æ‰¾åˆ°è§£å†³æ–¹å¼ã€‚

è¿˜æœ‰ä¸€ä¸ªå‘æ˜¯ä¸€äº›å°ä¼— npm åŒ…å­˜åœ¨æ·˜å®æºåŒæ­¥ä¸åŠæ—¶çš„æƒ…å†µï¼Œè¿™æ—¶å€™è¦åˆ°æ·˜å® npm æ‰‹åŠ¨ `sync` ä¸€ä¸‹è¿™ä¸ª npm åŒ…

é€šè¿‡ web æ–¹å¼æ¥åŒæ­¥: [/sync/connect](https://npm.taobao.org/sync/connect)

```sh
open https://npm.taobao.org/sync/connect
```

## npx

å’Œ nvm å’Œ nrm ä¸åŒçš„æ˜¯ï¼Œnpx è§£å†³çš„æ˜¯ä¸€äº›æ¯”è¾ƒç»†èŠ‚æ–¹é¢çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼š

1. ç”¨äºç®€åŒ–åœ¨ç»ˆç«¯ä¸­å¯¹ **node_modules** ä¸‹ **.bin** æ–‡ä»¶çš„ç›´æ¥æ‰§è¡Œ

2. ä½¿ç”¨æŸä¸ªå…¨å±€å‘½ä»¤è¡Œå·¥å…·æ—¶å€™ï¼Œä¸‹è½½ä½¿ç”¨å®Œå°±è‡ªåŠ¨åˆ é™¤ï¼Œé¿å…æ±¡æŸ“å…¨å±€ç¯å¢ƒ

### ç”¨äºç®€åŒ–åœ¨ç»ˆç«¯ä¸­å¯¹ node_modules ä¸‹ .bin æ–‡ä»¶çš„ç›´æ¥æ‰§è¡Œ

**ğŸŒ°ï¼š** Taro æ˜¯ä¸€ä¸ªå¤šç«¯å°ç¨‹åºå¼€å‘æ¡†æ¶ï¼Œå¦‚æœåœ¨ç»ˆç«¯é€šè¿‡ `taro` å‘½ä»¤ç¼–è¯‘ä»£ç ï¼Œå¯åœ¨é¡¹ç›®å†…éƒ¨å®‰è£… `taro cli`ï¼Œå¹¶è¿›å…¥é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ:

```sh
node_modules/.bin/taro build --type weapp
```

å¦‚æœä½ åªæ˜¯æƒ³è¦åœ¨ç»ˆç«¯ä¸´æ—¶æ‰§è¡Œå‘½ä»¤ï¼Œè€Œå¹¶ä¸æƒ³æŠŠå‘½ä»¤é…ç½®åˆ° `package.json` çš„ `script` å­—æ®µä¸‹ï¼Œè¿™æ—¶å¯ä»¥åœ¨ç»ˆç«¯é€šè¿‡ `npx` è¿›è¡Œç®€åŒ–

```sh
npx taro build --type weapp
# ç­‰æ•ˆäº: node_modules/.bin/taro build --type weapp
```

### é¿å…æ±¡æŸ“å…¨å±€ç¯å¢ƒ

npx çš„å¦å¤–ä¸€ä¸ªä½œç”¨æ˜¯è¿‡å¤šçš„å…¨å±€å‘½ä»¤è¡Œå·¥å…·é¿å…æ±¡æŸ“å…¨å±€ç¯å¢ƒã€‚

æœ‰å¾ˆå¤šæ¡†æ¶çš„ä¸Šæ‰‹æ•™ç¨‹é‡Œä¼šä½¿ç”¨ `npx` æ¥ä¸‹è½½è„šæ‰‹æ¶å¹¶åˆå§‹åŒ–é¡¹ç›®ï¼Œå®ƒä»¬çš„æ„æ€å…¶å®æ˜¯ï¼š

> â€œå¦‚æœä½ åªæ˜¯ä¸‹ä¸ª demo ç©ä¸€ç©çš„è¯ï¼Œå°±ä¸æ±¡æŸ“å…¨å±€ç¯å¢ƒç»™ä½ æ·»éº»çƒ¦äº†â€

ä¾‹å¦‚ä¸‹é¢çš„ `npx` å‘½ä»¤ï¼Œä¼šä¸‹è½½ `create-react-app` å¹¶ç”¨å…¶åˆå§‹åŒ– `my-app` é¡¹ç›®, ç”¨å®Œå°±å°† `create-react-app` åˆ é™¤ã€‚

```sh
npx create-react-app my-app
```

### npx æ‰§è¡Œå‘½ä»¤å’Œ package.json/script æ‰§è¡Œå‘½ä»¤çš„åŒºåˆ«

- ç›¸åŒç‚¹ï¼šéƒ½æ˜¯å…ˆä» `node_modules/.bin` è·¯å¾„ä¸‹å¯»æ‰¾æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åå†ä»å…¨å±€å¯»æ‰¾å‘½ä»¤

- ä¸åŒç‚¹ï¼š
  - å¯¹äº `npx`ï¼Œå½“å±€éƒ¨å’Œå…¨å±€éƒ½æ²¡æœ‰æ‰¾åˆ°æ‰§è¡Œå‘½ä»¤ä¼šä¸‹è½½å®‰è£…ç„¶åä½¿ç”¨
  - å¯¹äº `package.json` ä¸‹ `script` å­—æ®µé…ç½®çš„å‘½ä»¤ï¼Œ**å¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±æŠ¥é”™äº†ã€‚**

## [é¢è¯•å®˜ï¼šå¬è¯´ä½ å¯¹ package.json å¾ˆç†Ÿï¼Ÿ](https://zhuanlan.zhihu.com/p/384484213)

### åŸºç¡€ç‰ˆçš„ package.json

å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªåç§°ä¸º my-test çš„é¡¹ç›®æ—¶ï¼Œä½¿ç”¨ `yarn init -y` æˆ– `npm init -y` å‘½ä»¤åï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹ä¼šæ–°å¢ä¸€ä¸ª package.json æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```json
{
  "name": "my-test", # é¡¹ç›®åç§°
  "version": "1.0.0", # é¡¹ç›®ç‰ˆæœ¬ï¼ˆæ ¼å¼ï¼šå¤§ç‰ˆæœ¬.æ¬¡è¦ç‰ˆæœ¬.å°ç‰ˆæœ¬ï¼‰
  "description": "", # é¡¹ç›®æè¿°
  "main": "index.js", # å…¥å£æ–‡ä»¶
  "scripts": { # æŒ‡å®šè¿è¡Œè„šæœ¬å‘½ä»¤çš„ npm å‘½ä»¤è¡Œç¼©å†™
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [], # å…³é”®è¯
  "author": "", # ä½œè€…
  "license": "ISC" # è®¸å¯è¯
}
```

### scriptsï¼ˆå¿«æ·è„šæœ¬ï¼‰

`scripts` å­—æ®µæ˜¯ `package.json` ä¸­çš„ä¸€ç§å…ƒæ•°æ®åŠŸèƒ½ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„å±æ€§ä¸ºå¯ä»¥é€šè¿‡ `npm run` è¿è¡Œçš„è„šæœ¬ï¼Œå€¼ä¸ºå®é™…è¿è¡Œçš„å‘½ä»¤ï¼ˆé€šå¸¸æ˜¯ç»ˆç«¯å‘½ä»¤ï¼‰ï¼Œå¦‚ï¼š

```json
"scripts": {
  "start": "node index.js"
}
```

> æ›´å¤šå†…å®¹ï¼šè§ä¸Šæ–‡ [npm scripts](#npm-run-æ‰§è¡Œè„šæœ¬)

### dependencies & devDependenciesï¼ˆé¡¹ç›®ä¾èµ–ï¼‰

- **`dependencies` å­—æ®µæŒ‡å®šäº†é¡¹ç›®è¿è¡Œæ‰€ä¾èµ–çš„æ¨¡å—**ï¼šå¯ä»¥ç†è§£ä¸ºæˆ‘ä»¬çš„é¡¹ç›®åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œä¸­è¦ç”¨åˆ°çš„ä¸œè¥¿ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬å¸¸ç”¨çš„ antd åªèƒ½å“ªä¸ªä»£ç å—å°±ä¼šç”¨åˆ°é‡Œé¢çš„ç»„ä»¶ï¼Œæ‰€ä»¥è¦æ”¾åˆ° `dependencies` é‡Œé¢å»ã€‚

- **`devDependencies` å­—æ®µæŒ‡å®šäº†é¡¹ç›®å¼€å‘æ‰€éœ€è¦çš„æ¨¡å—ï¼š** å¼€å‘ç¯å¢ƒä¼šç”¨åˆ°çš„ä¸œè¥¿ï¼Œæ¯”å¦‚è¯´ webpackã€‚æˆ‘ä»¬æ‰“åŒ…çš„æ—¶å€™ä¼šç”¨åˆ°ï¼Œä½†æ˜¯é¡¹ç›®è¿è¡Œçš„æ—¶å€™å´ç”¨ä¸åˆ°ï¼Œæ‰€ä»¥åªéœ€è¦æ”¾åˆ° `devDependencies` ä¸­å»å°±å¥½äº†ã€‚

### mainï¼ˆä¸»è¦å…¥å£ï¼‰

- `main`Â å­—æ®µæ˜¯Â `package.json`Â ä¸­çš„å¦ä¸€ç§å…ƒæ•°æ®åŠŸèƒ½ï¼Œå®ƒå¯ä»¥ç”¨æ¥æŒ‡å®šåŠ è½½çš„å…¥å£æ–‡ä»¶ã€‚å‡å¦‚ä½ çš„é¡¹ç›®æ˜¯ä¸€ä¸ªÂ npmÂ åŒ…ï¼Œå½“ç”¨æˆ·å®‰è£…ä½ çš„åŒ…åï¼Œ`require('ç¬¬ä¸‰æ–¹æ¨¡å—')`Â è¿”å›çš„æ˜¯Â `main`Â å­—æ®µä¸­æ‰€åˆ—å‡ºæ–‡ä»¶çš„Â `module.exports`Â å±æ€§ã€‚

- å½“ä¸æŒ‡å®š `main`Â å­—æ®µæ—¶ï¼Œé»˜è®¤å€¼æ˜¯æ¨¡å—æ ¹ç›®å½•ä¸‹é¢çš„ `index.js`Â æ–‡ä»¶ã€‚

### binï¼ˆè‡ªå®šä¹‰å‘½ä»¤ï¼‰

<!-- TODO -->

<!-- å¾ˆå¤šåŒ…éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä»–ä»¬æƒ³è¦å®‰è£…åˆ° PATH ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚npm ä½¿è¿™å˜å¾—éå¸¸ç®€å•ï¼ˆå®é™…ä¸Šï¼Œå®ƒä½¿ç”¨æ­¤åŠŸèƒ½æ¥å®‰è£…â€œnpmâ€å¯æ‰§è¡Œæ–‡ä»¶ã€‚ï¼‰

è¦ä½¿ç”¨å®ƒï¼Œè¯· `bin` åœ¨ package.json ä¸­æä¾›ä¸€ä¸ªå­—æ®µï¼Œå®ƒæ˜¯å‘½ä»¤ååˆ°æœ¬åœ°æ–‡ä»¶åçš„æ˜ å°„ã€‚åœ¨å®‰è£…æ—¶ï¼Œnpm ä¼šå°†è¯¥æ–‡ä»¶ç¬¦å·é“¾æ¥åˆ° `prefix/bin` å…¨å±€å®‰è£…æˆ– `./node_modules/.bin/` æœ¬åœ°å®‰è£…ã€‚

ç»™å¤§å®¶çœ‹çœ‹æˆ‘è‡ªå·±åšä¸€ä¸ªç®€å•çš„ demoï¼š

{
  "name": "react-cli-library",
  "version": "0.0.2",
  "description": "",
  "bin": {
    "react-cli": "./bin/index.js"
  },
}

æˆ‘çš„åç§°å«åšreact-cli-libraryã€‚

æ‰€ä»¥ï¼Œ`npm i react-cli-library`

![](https://pic2.zhimg.com/80/v2-6777e0ac0b1d8514f8e755de0c05e77d_1440w.jpg)

å®‰è£…å®Œæˆä¹‹åï¼Œæ‰§è¡Œreact-cliå°±ä¼šæœ‰ä¸€äº›å‘½ä»¤ï¼Œä»–ä¼šæ‰§è¡Œæˆ‘çš„æ ¹ç›®å½•åº•ä¸‹`./bin/index.js`è¿™ä¸ªæ–‡ä»¶ã€‚

![](https://pic2.zhimg.com/80/v2-90bb4956b588876b561e5dfaf0f8d629_1440w.jpg)

è™½ç„¶æˆ‘çš„é¡¹ç›®åç§°æ˜¯ï¼š`react-cli-library`ã€‚ä½†æ˜¯æˆ‘æ‰§è¡Œçš„å†…å®¹å´æ˜¯`react-cli`ï¼Œè¿™ä¸ªå–å†³äºbinçš„å†…å®¹ -->

### package.json å’Œ package-lock.json æœ‰å“ªäº›åŒºåˆ«å’Œä½œç”¨ï¼Ÿ

ç®€å•çš„è¯´ï¼ŒåŒä¸€ä¸ª package.json åœ¨ä¸¤æ¬¡ install çš„æ—¶å€™å®‰è£…çš„ä¾èµ–å¯èƒ½ä¸ä¸€æ ·ã€‚ ä½†æ˜¯ lock æ–‡ä»¶å¯ä»¥ä¿è¯ä¸ç®¡å‡ æ¬¡å®‰è£…ï¼Œå®‰è£…çš„ä¾èµ–éƒ½æ˜¯ä¸€æ ·çš„ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ª package.json ç®€å•ç¤ºä¾‹

```json
{
  "name": "test-project",
  "version": "1.0.0",
  "description": "A test project",
  "author": "xxx",
  "scripts": {},
  "dependencies": {
    "vue": "^2.6.0",
    "cross-env": "~5.2.0",
    "element-ui": "*",
    "axios": "18.0.0"
  },
  "devDependencies": {
  }
}
```

æˆ‘ä»¬çœ‹ä¸Šè¿°æ–‡ä»¶çš„ä¾èµ–ç‰ˆæœ¬æœ‰å››ç§ï¼š

- `~` å¼€å¤´çš„ç‰ˆæœ¬ä¼šåŒ¹é…æœ€è¿‘çš„å°ç‰ˆæœ¬ä¾èµ–åŒ…ï¼Œæ¯”å¦‚ ~1.2.3 ä¼šåŒ¹é…æ‰€æœ‰ 1.2.x ç‰ˆæœ¬ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬ 1.3.0
- `^` å¼€å¤´çš„ç‰ˆæœ¬ä¼šåŒ¹é…æœ€æ–°çš„æ¬¡ç‰ˆæœ¬ä¾èµ–åŒ…ï¼Œæ¯”å¦‚ ^1.2.3 ä¼šåŒ¹é…æ‰€æœ‰ 1.x.x çš„åŒ…ï¼ŒåŒ…æ‹¬ 1.3.0ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬ 2.0.0
- `*` è¿™æ„å‘³ç€å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–åŒ…
- ä¸å¸¦ä»¥ä¸Šå‰ç¼€çš„å°±æ˜¯ä¸‹è½½å›ºå®šçš„ç‰ˆæœ¬å·

å½“æˆ‘ä»¬é¦–æ¬¡æ‰§è¡Œ `npm install` çš„æ—¶å€™ä¼šæ ¹æ®ä¸Šè¿°è§„åˆ™å»ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ä¾èµ–åŒ…ï¼Œç„¶åç”Ÿæˆ package-lock.json æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶è®°å½•äº†å®é™…ä¸‹è½½çš„ç‰ˆæœ¬ï¼Œè¿™æ ·å½“æˆ‘ä»¬æŠŠé¡¹ç›®æäº¤åˆ° git ä¸Šåï¼Œå…¶ä»–äºº clone åæ‰§è¡Œ `npm install`ï¼Œç”±äºå­˜åœ¨ package-lock.json æ–‡ä»¶ï¼Œå®‰è£…çš„æ—¶å€™ä¼šæ ¹æ® package-lock.json æ–‡ä»¶å£°æ˜çš„ç‰ˆæœ¬å»å®‰è£…ï¼Œ**è¿™æ ·å°±èƒ½ä¿è¯æ¯ä¸ªäººå®‰è£…çš„ä¾èµ–åŒ…ç‰ˆæœ¬éƒ½æ˜¯ä¸€æ ·çš„äº†**ã€‚

- package.json ä»…ä¼š**ç”³è¯·ä¾èµ–åŒ…åŠå…¶ç‰ˆæœ¬èŒƒå›´**ã€‚è€Œ lock æ–‡ä»¶ä¼šç”³æ˜å…·ä½“çš„è¯·æ±‚åœ°å€ï¼Œå…·ä½“çš„ç‰ˆæœ¬å·ï¼Œç”šè‡³ sha å€¼ï¼ˆæ€•åˆ«äººä¿®æ”¹å·²æœ‰åŒ…ï¼‰ã€‚
- lock æ–‡ä»¶è®°å½•çš„ä¾èµ–ä¿¡æ¯æ¯” package.json æ›´å…¨ã€‚lock æ–‡ä»¶ï¼Œæ˜¯ package.json é¡¹ç›®æ— æ³•å®Œæ•´æè¿°ä¾èµ–æ ‘çš„å¦ä¸€ä¸ªè¡¥å……æ–‡ä»¶ã€‚

ä¸ºä»€ä¹ˆè¦ä¿è¯ç‰ˆæœ¬ä¸€æ ·å‘¢ï¼Œé¦–å…ˆä¾èµ–åŒ…æœ¬èº«å‡çº§å¯èƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å¯èƒ½ä¼šä¸ç°æœ‰ä»£ç åº“æœ‰å…¼å®¹é—®é¢˜ï¼Œä¹Ÿå¯èƒ½ä¸å…¶ä»–ä¾èµ–åŒ…æœ‰å…¼å®¹é—®é¢˜ï¼Œæ‰€ä»¥ä¿è¯æ¯ä¸ªç¯å¢ƒçš„ç‰ˆæœ¬ä¸€è‡´æ˜¯æœ‰å¿…è¦çš„ã€‚

å¦‚éœ€å‡çº§éœ€è¦ç»è¿‡æµ‹è¯•åœ¨å°† package-lock.json æäº¤åˆ°ä»£ç åº“ï¼Œè¿™æ ·å…¶ä»–äººé‡æ–°æ‹‰å–ä»£ç æ‰§è¡Œ npm install å°±å®Œæˆä¾èµ–çš„å‡çº§äº†ã€‚

**ğŸ’¥ å°çŸ¥è¯†ï¼š**

èµ·åˆã€‚æ˜¯åªæœ‰ package.json çš„ã€‚å¹¶ä¸” package.json æ˜¯ç”¨æ¥æè¿°å½“å‰çš„ npm åŒ…ä¿¡æ¯çš„ã€‚è¿™äº›ä¿¡æ¯ä¿æŠ¤å½“å‰ npm åŒ…çš„åç§°ï¼Œç‰ˆæœ¬ï¼Œä½œè€…ï¼Œä»“åº“ï¼Œissue çš„åœ°å€ã€‚è¿˜æœ‰å…¥å£æ–‡ä»¶ main ç­‰ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ã€‚åˆšå¼€å§‹ npm åªæ˜¯ node çš„åŒ…ç®¡ç†å¹³å°ã€‚åæ¥æ‰“è´¥äº†å…¶å®ƒçš„åŒ…ç®¡ç†å·¥å…·ï¼Œé€æ­¥**ä¹Ÿæˆä¸ºäº†å‰ç«¯çš„åŒ…ç®¡ç†å¹³å°**ã€‚å› ä¸ºå‰ç«¯ä»£ç åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œå’Œ node åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„å·®å¼‚ã€‚package.json ä¹Ÿå‡ºç°äº† browser å…¥å£ã€‚æœŸé—´è¿˜æœ‰æè®® module å’Œ esnext å½“æˆ es6 çš„å…¥å£ï¼Œä¸è¿‡æœ€ç»ˆ node å’Œ webpack æŠŠ **module** ä½œä¸º esModule çš„å…¥å£æ–‡ä»¶ã€‚

è¿˜æœ‰ npm æœ¬æ¥æ˜¯ç”¨ javascript å†™ä»£ç çš„ã€‚typescript å‡ºæ¥åï¼Œpackage.json å‡ºäº†ä¸€ä¸ªå« types çš„å­—æ®µã€‚æ¥æŒ‡å®šç±»å‹å…¥å£æ–‡ä»¶ã€‚

ä¹Ÿæœ‰ä¸€äº›å·¥å…·å¦‚ babelï¼Œhuskyï¼Œå…è®¸ç”¨æˆ·å°†é…ç½®å†™åˆ° package.json ä¸­ã€‚è¿™è¯´æ˜ package.json æ˜¯**åŒ…çš„ä¿¡æ¯è®°å½•æ–‡ä»¶**ã€‚é™¤äº†å®˜æ–¹çš„ä¿¡æ¯è¿˜æœ‰å…¶å®ƒç¤¾åŒºå¼€æºåº“ä¹Ÿç”¨å®ƒæ¥è®°å½•ä¿¡æ¯ã€‚å¹¶ä¸”éšç€æ—¶é—´çš„å‘å±•ï¼Œè®°å½•ä¿¡æ¯çš„å­—æ®µä¹Ÿè¶Šæ¥è¶Šå¤šã€‚

### [npm ä¸ yarn å¯¹ peerDependencies å¤„ç†çš„å·®å¼‚](https://zhuanlan.zhihu.com/p/237532427)

1. å¦‚æœå¸Œæœ›ä¾› npm ä½¿ç”¨ï¼Œä¸”ä½ åªæ˜¯ä¸€ä¸ª npm åŒ…è€Œä¸æ˜¯ä¾èµ–é“¾ç»ˆç‚¹çš„å®é™… appï¼Œé‚£ä¹ˆä¸è¦â€œå¸®ç”¨æˆ·â€å®‰è£… peer ä¾èµ–ï¼Œè€Œæ˜¯åœ¨è‡ªå·±çš„ package.json ä¸­åŠ ä¸Šç›¸åŒçš„ peerDependenciesï¼Œè¯·æœ€ç»ˆç”¨æˆ·æ¥æ»¡è¶³è¿™äº›ä¾èµ–ã€‚
2. å¦‚æœä»…ä¾› yarn ä½¿ç”¨ï¼Œä½ å¯ä»¥æ”¾å¿ƒåœ°å¸®ç”¨æˆ·æŠŠ peer ä¾èµ–å…¨éƒ¨æå®šï¼Œä¿æŒå¯¹ç”¨æˆ·å°è£…æ•ˆæœï¼Œå‡å°‘ç”¨æˆ·çš„ä½¿ç”¨æˆæœ¬ã€‚
3. ç”±äºè¿™ç§æƒ…å†µå‡ºç°çš„æ¦‚ç‡å…¶å®å¾ˆå°ï¼Œä¸” npm 7.x ä¼šè§£å†³è¿™ä¸€é—®é¢˜ï¼Œå› æ­¤æ¨èå¸®ç”¨æˆ·è£…ä¸Š peer ä¾èµ–ï¼ŒçœŸå‡ºäº†æ„å¤–å¯ä»¥æ¨èç”¨æˆ·å®‰è£… npm 7.xã€‚
