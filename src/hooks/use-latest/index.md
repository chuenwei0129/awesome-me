---
nav:
  title: Package
  order: 0
group:
  title: Hooks
title: useLatest
toc: content
---

# useLatest

è¿”å›å½“å‰æœ€æ–°å€¼çš„ Hookã€‚

## ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ

### é—®é¢˜åœºæ™¯

è€ƒè™‘ä¸€ä¸ªèŠå¤©è¾“å…¥æ¡†ï¼šç‚¹å‡»"å‘é€"åï¼Œ3 ç§’åå¼¹å‡ºæç¤ºæ¡†æ˜¾ç¤ºå‘é€å†…å®¹ã€‚

<code src="./examples/1.tsx"></code>

**å¤ç°æ­¥éª¤**ï¼šè¾“å…¥ "123" â†’ ç‚¹å‡»å‘é€ â†’ å¿«é€Ÿæ”¹ä¸º "456" â†’ 3 ç§’åæç¤ºæ¡†æ˜¾ç¤º "123"

ä¸ºä»€ä¹ˆä¸æ˜¯ "456"ï¼Ÿ

### æ ¹å› ï¼šé—­åŒ…é™·é˜±

è¿™æ˜¯ React å‡½æ•°ç»„ä»¶çš„ç»å…¸é—®é¢˜â€”â€”**é—­åŒ…é™·é˜±ï¼ˆStale Closureï¼‰**ã€‚

```tsx
function handleSend() {
  setTimeout(() => {
    alert('æ­£åœ¨å‘é€ï¼š' + text); // text è¢«é—­åŒ…æ•è·
  }, 3000);
}
```

å½“ç‚¹å‡»å‘é€æ—¶ï¼Œ`handleSend` å½¢æˆé—­åŒ…ï¼Œ**æ•è·äº†å½“æ—¶çš„ `text` å€¼**ã€‚å³ä½¿åç»­ `text` æ›´æ–°è§¦å‘é‡æ¸²æŸ“ï¼Œé—­åŒ…å†…çš„ `text` ä»æ˜¯æ—§å€¼ã€‚

```
æ—¶é—´çº¿ï¼š
t0: text="123", ç‚¹å‡»å‘é€, setTimeout é—­åŒ…æ•è· text="123"
t1: text="456", ç»„ä»¶é‡æ¸²æŸ“
t3: setTimeout å›è°ƒæ‰§è¡Œ, è¯»å–é—­åŒ…ä¸­çš„ text="123" âŒ
```

### ä¸ºä»€ä¹ˆ React è¦è¿™æ ·è®¾è®¡ï¼Ÿ

è¿™æ˜¯ React Hooks çš„**æœ‰æ„ä¸ºä¹‹**ï¼Œç¡®ä¿æ¯æ¬¡æ¸²æŸ“çš„ä¸€è‡´æ€§ï¼š

- **å‡½æ•°ç»„ä»¶**ï¼šæ¯æ¬¡æ¸²æŸ“æ˜¯ç‹¬ç«‹çš„å¿«ç…§ï¼Œprops/state ä¸å¯å˜
- **Class ç»„ä»¶**ï¼š`this.state` æ˜¯å¯å˜çš„ï¼Œæ€»èƒ½æ‹¿åˆ°æœ€æ–°å€¼
- **Vue**ï¼šå“åº”å¼æ•°æ®å¤©ç„¶æ˜¯æœ€æ–°å€¼

> æ‹“å±•é˜…è¯»ï¼š[å‡½æ•°å¼ç»„ä»¶ä¸ç±»ç»„ä»¶æœ‰ä½•ä¸åŒï¼Ÿ](https://overreacted.io/zh-hans/how-are-function-components-different-from-classes/)

## æ˜¯ä»€ä¹ˆï¼Ÿ

`useLatest` æ˜¯ä¸€ä¸ªåˆ©ç”¨ `useRef` çªç ´é—­åŒ…é™åˆ¶çš„ Hookï¼Œè®©ä½ åœ¨å¼‚æ­¥å›è°ƒä¸­å§‹ç»ˆèƒ½è®¿é—®åˆ°æœ€æ–°å€¼ã€‚

### å®ç°åŸç†

```tsx
import { useRef } from 'react';

function useLatest<T>(value: T) {
  const ref = useRef<T>(value);
  ref.current = value;  // æ¯æ¬¡æ¸²æŸ“éƒ½åŒæ­¥æœ€æ–°å€¼

  return ref;
}
```

**æ ¸å¿ƒæ€è·¯**ï¼šç”¨ `ref.current` ä½œä¸º"é€ƒç”Ÿèˆ±"

| ç‰¹æ€§ | `useState` | `useRef` |
|------|-----------|----------|
| å€¼å˜åŒ–è§¦å‘æ¸²æŸ“ | æ˜¯ | å¦ |
| è·¨æ¸²æŸ“ä¿æŒå¼•ç”¨ | å¦ï¼ˆæ¯æ¬¡æ–°å€¼ï¼‰ | æ˜¯ï¼ˆåŒä¸€å¯¹è±¡ï¼‰ |
| é—­åŒ…ä¸­è®¿é—® | æ•è·æ—¶çš„å€¼ | **å§‹ç»ˆæœ€æ–°** |

**ä¸ºä»€ä¹ˆ `ref.current` èƒ½æ‹¿åˆ°æœ€æ–°å€¼ï¼Ÿ**

```
æ¸²æŸ“1: ref = { current: "123" }
       â†“ é—­åŒ…æ•è·çš„æ˜¯ ref å¯¹è±¡çš„å¼•ç”¨ï¼ˆåœ°å€ï¼‰
æ¸²æŸ“2: ref.current = "456"  // ä¿®æ”¹çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡
       â†“
å›è°ƒæ‰§è¡Œ: ref.current â†’ "456" âœ…
```

é—­åŒ…æ•è·çš„æ˜¯ `ref` **å¯¹è±¡çš„å¼•ç”¨**ï¼Œè€Œé `ref.current` çš„å€¼ã€‚ç”±äº `ref` å¯¹è±¡åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜ï¼Œé€šè¿‡ `ref.current` æ€»èƒ½è®¿é—®åˆ°æœ€æ–°å†™å…¥çš„å€¼ã€‚

### æ‰§è¡Œæ—¶æœº

```tsx
function useLatest<T>(value: T) {
  const ref = useRef<T>(value);
  ref.current = value;  // ğŸ‘ˆ åœ¨æ¸²æŸ“é˜¶æ®µåŒæ­¥æ‰§è¡Œï¼Œé useEffect
  return ref;
}
```

ä¸ºä»€ä¹ˆä¸ç”¨ `useEffect` æ›´æ–°ï¼Ÿ

- `useEffect` åœ¨æ¸²æŸ“åå¼‚æ­¥æ‰§è¡Œï¼Œå­˜åœ¨æ—¶åºé—®é¢˜
- ç›´æ¥èµ‹å€¼åœ¨æ¸²æŸ“é˜¶æ®µåŒæ­¥å®Œæˆï¼Œä¿è¯ç«‹å³å¯ç”¨

## æ€ä¹ˆç”¨ï¼Ÿ

### åŸºç¡€ç”¨æ³•

<code src="./examples/2.tsx"></code>

### API

```typescript
function useLatest<T>(value: T): React.MutableRefObject<T>
```

#### å‚æ•°

| å‚æ•°  | è¯´æ˜               | ç±»å‹ | é»˜è®¤å€¼ |
| ----- | ------------------ | ---- | ------ |
| value | éœ€è¦è¿½è¸ªæœ€æ–°å€¼çš„å˜é‡ | `T`  | -      |

#### è¿”å›å€¼

| ç±»å‹                        | è¯´æ˜                                     |
| --------------------------- | ---------------------------------------- |
| `React.MutableRefObject<T>` | ref å¯¹è±¡ï¼Œé€šè¿‡ `.current` è®¿é—®æœ€æ–°å€¼ |

### å…¸å‹åœºæ™¯

1. **å®šæ—¶å™¨/å»¶è¿Ÿå›è°ƒ**ï¼š`setTimeout`ã€`setInterval`
2. **äº‹ä»¶ç›‘å¬å™¨**ï¼šéœ€è¦è®¿é—®æœ€æ–° state çš„äº‹ä»¶å¤„ç†
3. **å¼‚æ­¥è¯·æ±‚**ï¼šè¯·æ±‚å®Œæˆåéœ€è¦æœ€æ–°æ•°æ®åšåˆ¤æ–­
4. **ç¬¬ä¸‰æ–¹åº“å›è°ƒ**ï¼šå¦‚ WebSocketã€åŠ¨ç”»åº“çš„å›è°ƒå‡½æ•°

### æ³¨æ„äº‹é¡¹

- ä¸è¦ç›´æ¥ä¿®æ”¹ `ref.current`ï¼Œåªè¯»ä½¿ç”¨
- å¦‚æœéœ€è¦ä¿®æ”¹å€¼ï¼Œåº”è¯¥é€šè¿‡ `setState` æ›´æ–°æºæ•°æ®
