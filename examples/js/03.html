<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
	<body>
		<script>
			// 因为 new 是关键字,所以我们写一个函数，命名为 _new，
			// 来模拟 new 的效果。用的时候是这样的：
			// var f = new F(...) === var f = _new(F, ...)

			function _new() {
				// 处理参数
				var constructor = [].shift.call(arguments)
				// 创建一个新的实例对象
				var instance = {}
				// 把实例的 __proto__ 指向构造函数的 prototype
				var instance = Object.create(constructor.prototype)
				// 改变 this 指向，处理传参
				// 构造函数如果有返回值是对象的情况下，会返回该对象 new 出的实例就是该对象，其他返回实例对象
				// res 储存构造函数的返回值，apply 和 call 都相当于函数执行了一次，只是函数执行环境变化
				var res = constructor.apply(instance, arguments)
				// 返回实例对象
				return typeof res === 'object' && res != null ? res : instance
			}

			// 测试
			function Person(name, age) {
				this.name = name
				this.age = age
				// return {
				// 	name: name,
				// 	age: age,
				// }
			}

			Person.prototype.sayName = function () {
				console.log(`我的名字：${this.name}，我的年龄：${this.age}。`)
			}

			var student = new Person('xiaoming', 23)
			student.sayName() // 我的名字：xiaoming，我的年龄：23。

			var teacher = _new(Person, 'malaoshi', 35)
			teacher.sayName() // 我的名字：malaoshi，我的年龄：35。
		</script>
	</body>
</html>
