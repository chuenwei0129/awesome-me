# Git 的工作区域和流程

> 这条笔记创建于: 2022 年 10 月 27 日，星期四，22: 07。

## Git 的工作区域

![](https://raw.githubusercontent.com/chuenwei0129/my-picgo-repo/master/terminal/613861755_1618028580119_014AA794B8DE2B0593F9F6C4BE7243D9.png)

- **Workspace**：工作区，就是平时进行开发改动的地方，是当前看到最新的内容，在开发的过程也就是对工作区的操作。

  > Git 可以把工作区中的文件处理、压缩成一个提交对象，也能将取得的提交对象解包成文件同步到工作区中。

- **Index**：暂存区（ Stage ），当执行 `git add` 的命令后，工作区的文件就会被移入暂存区，暂存区标记了当前工作区中那些内容是被 Git 管理的，当完成某个需求或者功能后需要提交代码，第一步就是通过 `git add` 先提交到暂存区。

  1. Git 把它作为工作区与提交历史之间的中间区域，方便我们对提交内容进行组织：我们可能会在工作区同时更改多个完全不相干的文件，这时可以将它们分别放入暂存区，并在不同的提交中加入提交历史。此外暂存区还用于合并冲突时存放文件的不同版本。
  2. **除非是一个刚刚初始化的 Git 仓库，否则暂存区并不是空的**，它会填充最近一次提交所对应的文件快照，因此当我们基于最近一次提交在工作区做了一些修改之后，`git status` 会将工作区的文件与暂存区的文件快照进行对比，并提示我们有哪些做了修改的文件尚未加入暂存区。

- **Repository**：本地仓库，位于自己的电脑上，通过 `git commit` 提交暂存区的内容，会进入本地仓库。

- **Remote**：远程仓库，用来托管代码的服务器，远程仓库的内容能够被分布在多个地点的处于协作关系的本地仓库修改，本地仓库修改完代码后通过 `git push` 命令同步代码到远程仓库。

## Git 的工作流程

![](https://raw.githubusercontent.com/chuenwei0129/my-picgo-repo/master/terminal/git-three-trees.png)

1. 假设我们进入到一个新目录，其中有一个 README 文件。此时暂存区为空，提交历史为空，HEAD 引用指向未创建的 master 分支。
1. 现在我们想提交该文件，首先需要通过 `git add` 将其添加到暂存区。此时 Git 将在 `.git/objects` 目录中以该文件的内容生成一个 blob 对象，并将 blob 对象的信息添加到 `.git/index` 文件中。
1. 接着运行 `git commit`，它会取得暂存区中的内容生成一个 tree 对象，该 tree 对象即为工作区文件的永久快照，然后创建一个指向该 tree 对象的提交对象，最后更新 master 指向本次提交。
1. 假如我们在工作区编辑了文件，Git 会将其与暂存区现有文件快照进行比较，在 `git add` 了更改的文件后，根据文件当前内容生成新的 blob 对象并更新 `.git/index` 文件中的引用 ID。`git commit` 的过程与之前类似，但是新的提交对象会以 HEAD 引用指向的提交作为父提交，然后更新其引用的 master 指向新创建的提交。
1. 当我们 `git checkout` 一个分支或提交时，它会修改 HEAD 指向新的分支引用或提交，将暂存区填充为该次提交的文件快照，然后将暂存区的内容解包复制到工作区中。
