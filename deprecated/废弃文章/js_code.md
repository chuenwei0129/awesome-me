# JavaScript ‰ªéÈõ∂ÂçïÊéí(‰πù)<!-- omit in toc -->

## call / apply

```js
const foo = {
  val: 1
}

function bar() {
  return this.val
}

console.log(
  bar.call(foo)
  // bar.call(1)
)

// this ÊåáÁöÑÊòØÂáΩÊï∞ÊâßË°åÁéØÂ¢ÉÔºåcall Ë∞ÉÁî®Êó∂Á≠âÂêå‰∫éÊää bar ÁöÑÊâßË°åÁéØÂ¢ÉÊîπÊàê fooÔºåÁ≠âÂêå‰∫éÁªô foo ÂØπË±°Ê∑ªÂä† bar ÊñπÊ≥ï
// Áî±‰∫éÁªô foo ÂØπË±°Ê∑ªÂä†‰∫Ü‰∏Ä‰∏™Â±ûÊÄßÔºåÊâÄ‰ª•ÊúÄÂêéÊàë‰ª¨ÈúÄË¶Å delete ÂÆÉ
// ÊâÄ‰ª• call ÁöÑÊ®°ÊãüÊ≠•È™§ÂèØ‰ª•ÊäΩË±°Êàê bar.call(foo) ==> foo.bar() ==> delete foo.bar

Function.prototype._call = function (thisArg, ...args) {
  // Object(thisArg) ÊòØ‰∏∫‰∫ÜÈò≤Ê≠¢ 19 Ë°åÂá∫Áé∞Êï∞Â≠ó 2..tofixed()
  thisArg = thisArg ? Object(thisArg) : globalThis
  const key = Symbol('key')
  thisArg[key] = this
  const ret = thisArg[key](...args)
  delete thisArg[key]
  return ret
}

console.log(
  bar._call(foo)
  // bar._call(1)
)
```

## bind

```js
// 1. ‰∏ç‰º†ÂÄºÈªòËÆ§‰∏∫ globalThis, null, undefined, ÂéüÂßãÁ±ªÂûãÈÉΩÁî± call Â§ÑÁêÜ
// 2. Á¨¨‰∏ÄÊ¨°‰º†ÂÖ•ÁöÑÂèÇÊï∞ÈúÄË¶ÅÂíåÁ¨¨‰∫åÊ¨°‰º†ÂÖ•ÁöÑÂèÇÊï∞ÂêàÂπ∂
// 3. bindedFn ÂèØ‰ª•‰Ωú‰∏∫ÊûÑÈÄ†ÂáΩÊï∞ÔºåÊ≠§Êó∂ this ÁªëÂÆö‰ºöÂ§±ÊïàÔºå‰ºöÊåáÂêëÂÆû‰æã thisÔºå`this instanceof bindedFn` Êù•‰Ωú‰∏∫Âà§Êñ≠ÊòØÊûÑÈÄ†ÂáΩÊï∞ÔºåËøòÊòØÊôÆÈÄöË∞ÉÁî®
// 4. bindedFn ÁöÑÂÆû‰æãÈúÄË¶ÅÁªßÊâøÂéüÂáΩÊï∞ÂéüÂûã‰∏äÁöÑÊñπÊ≥ï `this.__proto__.__proto__ === that.prototype`
// bound ÊâßË°åÊâç‰ºöÊâßË°åÂéüÂáΩÊï∞

function fn(a, b) {
  console.log('this --> ', this)
  return a + b
}

const obj = { x: 1 }

const Bound = fn.bind(obj, 1)
console.log(Bound, Bound(2), new Bound())

Function.prototype._bind = function (thisArg, ...args) {
  // ÂáΩÊï∞ÈªòËÆ§ÂÄºÊó†Ê≥ïÂ§ÑÁêÜ null
  thisArg = thisArg || globalThis
  const fn = this
  const bound = function (...boundArgs) {
    // Â∑≤Áü• this.__proto__ === bound.prototype Ë¶ÅÂÆûÁé∞ fn ÂáΩÊï∞‰∏≠ this Á≠âÂêå‰∫éÂΩìÂâç this Âç≥ thisÔºàÂΩìÂâçthisÔºåÂõ†‰∏∫ thisFn.__proto__ === fn.prototypeÔºâ.__proto__ === fn.prototype
    // ÊâÄ‰ª•Âè™Ë¶ÅÊûÑÂª∫ÂéüÂûãÈìæÂÖ≥Á≥ªÂç≥ÂèØ
    // bound.prototype = Object.create(fn.prototype) // ‰ºö‰∏¢Â§± bound.prototype.constructor
    Object.setPrototypeOf(bound.prototype, fn.prototype)
    // this.__proto__ === fn.prototype ‰∏∫ÊûÑÈÄ†ÂáΩÊï∞Ë∞ÉÁî®ÔºåÂøΩÁï• thisArg ÁªëÂÆöÔºåÁõ¥Êé• call ÂÆû‰æã this
    return fn.call(this instanceof fn ? this : thisArg, ...boundArgs, ...args)
  }
  return bound
}

const _Bound = fn._bind(obj, 1)

console.log(_Bound, _Bound(2), new _Bound())

// this -->  { x: 1 }
// this -->  fn {}
// [Function: bound fn] 3 fn {}
// this -->  { x: 1 }
// this -->  fn {}
// [Function: bound] 3 fn {}
```

## new

```js
// Âõ†‰∏∫ new ÊòØÂÖ≥ÈîÆÂ≠ó,ÊâÄ‰ª•Êàë‰ª¨ÂÜô‰∏Ä‰∏™ÂáΩÊï∞ÔºåÂëΩÂêç‰∏∫ _newÔºå
// Êù•Ê®°Êãü new ÁöÑÊïàÊûú„ÄÇÁî®ÁöÑÊó∂ÂÄôÊòØËøôÊ†∑ÁöÑÔºö
// var f = new F(...) === var f = _new(F, ...)

function F() {
  this.age = 28
  // return null
  // return 1
  // return this
  return {
    age: 18,
    fn() {
      return this.age
    }
  }
}

F.prototype.fn = function () {
  return this.age
}

const f = new F()

console.log(typeof f, F.prototype === Object.getPrototypeOf(f), f.age, f.fn())

function _new() {
  const ctor = [].shift.call(arguments)
  const inst = Object.create(ctor.prototype)
  const ret = ctor.call(inst, ...arguments)
  return typeof ret === 'object' && ret !== null ? ret : inst
}

const _f = _new(F)

console.log(typeof _f, F.prototype === Object.getPrototypeOf(_f), _f.age, _f.fn())

// Ê≥®ÈáäÁâà
// function _new() {
//  // Â§ÑÁêÜÂèÇÊï∞
//  const constructor = [].shift.call(arguments)
//  // ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÂÆû‰æãÂØπË±°
//  // ÊääÂÆû‰æãÁöÑ __proto__ ÊåáÂêëÊûÑÈÄ†ÂáΩÊï∞ÁöÑ prototype
//  const instance = Object.create(constructor.prototype)
//  // ÊîπÂèò this ÊåáÂêëÔºåÂ§ÑÁêÜ‰º†ÂèÇ
//  // ÊûÑÈÄ†ÂáΩÊï∞Â¶ÇÊûúÊúâËøîÂõûÂÄºÊòØÂØπË±°ÁöÑÊÉÖÂÜµ‰∏ãÔºå‰ºöËøîÂõûËØ•ÂØπË±° new Âá∫ÁöÑÂÆû‰æãÂ∞±ÊòØËØ•ÂØπË±°ÔºåÂÖ∂‰ªñËøîÂõûÂÆû‰æãÂØπË±°
//  // res ÂÇ®Â≠òÊûÑÈÄ†ÂáΩÊï∞ÁöÑËøîÂõûÂÄºÔºåapply Âíå call ÈÉΩÁõ∏ÂΩì‰∫éÂáΩÊï∞ÊâßË°å‰∫Ü‰∏ÄÊ¨°ÔºåÂè™ÊòØÂáΩÊï∞ÊâßË°åÁéØÂ¢ÉÂèòÂåñ
//  const res = constructor.apply(instance, arguments)
//  // ËøîÂõûÂÆû‰æãÂØπË±°
//  console.log(typeof res)
//  return typeof res === 'object' && res !== null ? res : instance
// }
```

## instanceof

```js
const _instanceof = (left, right) => {
  // Á¨¨‰∏ÄÊ¨°Êü•ÊâæÂéüÂûã
  let proto = Object.getPrototypeOf(left)
  while (1) {
    // right ÊòØ callable ÊòØÂáΩÊï∞
    if (proto === right.prototype) return true
    if (proto === null) return false
    // ÈÄíÂΩíÊü•Êâæ
    proto = Object.getPrototypeOf(proto)
  }
}

console.log(Object instanceof Object)

console.log(_instanceof(Object, Object))
```

## flat

```js
const arr = [1, [2, { a: 1 }], [4, 5, [6, 7, 8, [9, [10]]]]]

// 1. toString ÊñπÊ≥ï Âè™ÈÄÇÂêà string[], number[] ...

// 2. api Ê≥®ÊÑèÁÇπ -> Â±ÇÊï∞
console.log(arr.flat(Infinity))

// 3. Ê≠£Âàô + Â∫èÂàóÂåñ„ÄÅÂèçÂ∫èÂàóÂåñ
console.log(JSON.parse(`[${JSON.stringify(arr).replace(/\[|\]/g, '')}]`))

// 4. ÈÄíÂΩí
// x ÊòØÊï∞ÁªÑÂ∞±ÈÄíÂΩí,‰∏çÊòØÂ∞±ÊîæÂÖ• ret ‰∏≠,ÈáçÁÇπÊòØ ret Èó≠ÂåÖ
const flat = (arr, ret = []) => {
  arr.forEach(x => {
    Array.isArray(x) ? flat(x, ret) : ret.push(x)
  })
  return ret
}

console.log(flat(arr))

// 5. reduce
// Êú¨Ë¥®ËøòÊòØÈÄíÂΩíÔºåÁ¥ØËÆ°Âô®Â≠òÂÇ® concat
const flatReduce = arr => {
  return arr.reduce((acc, cur) => {
    return acc.concat(Array.isArray(cur) ? flatReduce(cur) : cur)
  }, [])
}
console.log(flatReduce(arr))

// 6. while + some + concat ÂéüÁêÜÔºö...ÊãçÂπ≥‰∏ÄÂ±ÇÂêéÁöÑÈáåÈù¢ÁöÑÊï∞ÁªÑÂíåÊôÆÈÄöÂÄºÈÉΩ‰ºöË¢´ concat ÂêàÂπ∂ÊàêÊñ∞Êï∞ÁªÑÔºåÂèØ‰ª•Â∞ëÂæ™ÁéØ‰∏ÄÊ¨°
const flatWhile = arr => {
  // ÊòØÂê¶ÊúâÂ≠êÊï∞ÁªÑ
  while (arr.some(x => Array.isArray(x))) {
    // console.log('ÊâßË°åÊ¨°Êï∞')
    arr = [].concat(...arr)
  }
  return arr
}

console.log(flatWhile(arr))
```

## fib

```js
// 0„ÄÅ1„ÄÅ1„ÄÅ2„ÄÅ3„ÄÅ5„ÄÅ8„ÄÅ13„ÄÅ21„ÄÅ34

// fn(n) = f(n-1) + f(n-2)
// n === 2, n === 1

const fib = n => {
  if (n === 0) return 0
  if (n === 1) return 1

  return fib(n - 1) + fib(n - 2)
}

console.time('ÈÄíÂΩí')
fib(25)
console.timeEnd('ÈÄíÂΩí')

// ÁºìÂ≠òÊâßË°åÁªìÊûú
const memo = (fn, cahe = {}) => {
  // ÂéüÂáΩÊï∞ËøîÂõûÁöÑÊòØÂÄºÔºåÊâÄ‰ª•È´òÈò∂ÂáΩÊï∞‰πüËøîÂõûÁºìÂ≠òËøáÁöÑÂÄº
  return n => {
    if (!cahe[n]) {
      cahe[n] = fn(n)
    }
    return cahe[n]
  }
}

console.time('memo')
memo(fib)(25)
console.timeEnd('memo')

function loop(n) {
  let first = 0
  let second = 1
  let third = 1
  if (n === 0) return first
  if (n === 1) return second
  if (n === 2) return third
  for (let i = 3; i <= n; i++) {
    first = second
    second = third
    third = first + second
  }
  return third
}

console.log(loop(6))

// function fib(n){
//  function fib_(n,a,b){
//    if(n==0)  return a
//    else return fib_(n-1,b,a+b)
//  }
//  return fib_(n,0,1)
// }
```

## debounce / throttle

```js
// Ëß¶ÂèëÈ´òÈ¢ëÊó∂Èó¥ÂêénÁßíÂÜÖÂáΩÊï∞Âè™‰ºöÊâßË°å‰∏ÄÊ¨°,Â¶ÇÊûúnÁßíÂÜÖÈ´òÈ¢ëÊó∂Èó¥ÂÜçÊ¨°Ëß¶Âèë,ÂàôÈáçÊñ∞ËÆ°ÁÆóÊó∂Èó¥„ÄÇ// Á±ª‰ººÊîæÁÅ´ÁêÉÊúØÔºå‰∏ÄÁõ¥ÊâìÊñ≠‰ºöÊîæ‰∏çÂá∫ÂéªÔºåÁî®Êà∑ËæìÂÖ•ÂèëËØ∑Ê±Ç‰∏çÈÄÇÁî®ÔºådebounceÔºåÂª∂Êó∂
// 1ÂàõÂª∫‰∏ÄÊ¨°Âª∂ËøüÔºå2 Âà†Èô§‰∏ä‰∏ÄÊ¨°ÔºåÂàõÂª∫‰∏ÄÊ¨°Êñ∞ÁöÑÂª∂Ëøü
// È´òÈò∂ÂáΩÊï∞
function debounce(fn, delay = 300, timer = null) {
  return (...args) => {
    // timer ÈÄöËøáÈó≠ÂåÖ‰øùÂ≠òÔºå‰∏ã‰∏ÄÊ¨°ËøõÊù•‰ºöÊ∏ÖÈô§‰∏ä‰∏ÄÊ¨°ÂàõÂª∫ÁöÑ timer
    // debounce Âè™ÊâßË°å‰∏ÄÊ¨°ÔºåÊâßË°åÂ§öÊ¨°ÁöÑÊòØ‰ªñÁöÑËøîÂõûÂÄº
    // console.log('Ë∞ÉÁî® debounce Ê¨°Êï∞', ++i, '‰∏ä‰∏ÄÊ¨°Âª∫Á´ãÁöÑÂÆöÊó∂Âô® timer', timer)
    // ÊâÄ‰ª•‰øùËØÅ‰∫Ü 300 ms ÂÖßÂè™ÊâßË°å‰∏ÄÊ¨°
    clearTimeout(timer)
    timer = setTimeout(() => {
      fn(...args)
    }, delay)
  }
}

// È´òÈ¢ëÊó∂Èó¥Ëß¶Âèë,‰ΩÜnÁßíÂÜÖÂè™‰ºöÊâßË°åÊúÄÂêé‰∏ÄÊ¨°,ÊâÄ‰ª•ËäÇÊµÅ‰ºöÁ®ÄÈáäÂáΩÊï∞ÁöÑÊâßË°åÈ¢ëÁéá„ÄÇ // ËäÇÊµÅÔºå‰∏ÄÊÆµÊó∂Èó¥ÂÖßÂøÖÁÑ∂‰ºöÊâßË°å‰∏ÄÊ¨°Ôºåthrottle
// Êó∂Â∫èÂõæÂàÜÊûê
// 1-2-3-4-5---300ms---6-7-8-9-10---300ms---
// --------5----fn()---6-7-8-9-10----fn----

function throttle(fn, delay = 300) {
  // let lock = false Âíå Âú® (lock=false) ÂÜôÈÉΩ‰ºöÈó≠ÂåÖ
  // let lock = false ÂÜôÂú® () ‰∏≠Ôºådelay ÂøÖÈ°ª‰º†ÂÄºÔºåÂèÇÊï∞ÈªòËÆ§ÂÄºÁöÑÁâπÁÇπ
  let lock = false
  return (...args) => {
    if (lock) return
    // Á¨¨‰∏ÄÊ¨°‰∏çÈúÄË¶ÅËäÇÊµÅ
    fn(...args)
    lock = true
    // ‰πü‰∏çÈúÄË¶ÅÊ∏ÖÈô§ÂÆöÊó∂Âô®ÔºåËôΩÁÑ∂‰∏ÄÁõ¥ÁÇπÂèØËÉΩÂá∫Áé∞ÂÆöÊó∂Âô®Ê∑∑‰π±Ôºå‰ΩÜËøôÂ∞±ÊòØËäÇÊµÅÂïä
    setTimeout(() => {
      lock = false
    }, delay)
  }
}
```

## Observer

```js
// ‰∏ÄÂØπÂ§ö
class Observer {
  update(state) {
    console.log('Â∞èÂÆùÂÆùÁöÑÁä∂ÊÄÅ', state)
  }
}

class Subject {
  constructor() {
    this.state = 'üò≠'
    this.obs = []
  }
  attach(ob) {
    this.obs.push(ob)
  }
  notify() {
    this.obs.forEach(ob => ob.update(this.state))
  }
}

const baby = new Subject()

const father = new Observer()
const mother = new Observer()

baby.attach(father) // Â∞èÂÆùÂÆùÁöÑÁä∂ÊÄÅ üò≠ ==> Â∞èÂÆùÂÆùÁöÑÁä∂ÊÄÅ üòä
baby.attach(mother) // Â∞èÂÆùÂÆùÁöÑÁä∂ÊÄÅ üò≠ ==> Â∞èÂÆùÂÆùÁöÑÁä∂ÊÄÅ üòä

baby.notify() // Á¨¨‰∏ÄÊ¨°

baby.state = 'üòä'
baby.notify() // Á¨¨‰∫åÊ¨°
```

## eventEmitter

```js
const l = {
  tasks: [],
  caches: [],
  on(name, fn) {
    this.caches.length > 0
      ? this.caches.forEach((cache, idx) => {
          if (name in cache) {
            fn(...cache[name])
            this.caches.splice(idx, 1)
          }
        })
      : this.tasks.push({ [name]: fn })
  },
  emit(name, ...args) {
    // ÊúâÂèØËÉΩ‰∏ÄÁßçÊÉÖÂÜµ tasks Ê≤°‰ªªÂä°‰ΩÜËß¶Âèë‰∫Ü emit
    this.tasks.length === 0 && name && this.caches.push({ [name]: [...args] })
    this.tasks.forEach(task => {
      if (task[name]) {
        task[name](...args)
      } else {
        this.caches.push({ [name]: [...args] })
      }
    })
  },
  off(name) {
    this.tasks.forEach((task, idx) => {
      if (name in task) {
        this.tasks.splice(idx, 1)
      }
    })
  },
  once(name, fn) {
    this.on(name, (...args) => {
      // ÁâπÊÆäÁöÑ on ‰ª£ÁêÜ‰∏ÄÂ±Ç
      fn(...args)
      this.off(name)
    })
  }
}

// ÂÖà emit Âêé on
l.emit('world', 'world')
l.emit('test', 'test')
l.on('world', h => console.log(h)) // world
console.log('caches', l.caches) // caches [ { test: [ 'test' ] } ]
l.on('test', h => console.log(h)) // test
console.log('caches', l.caches) // caches []

// ÂÖà on
l.on('hello', h => console.log(h))
l.emit('hello', 'hello') // 'hello'
l.emit('hello', 'hello') // 'hello'

console.log('tasks', l.tasks) // tasks [ { hello: [Function] } ]

l.off('hello')

console.log('tasks', l.tasks) // tasks []

l.once('world', h => console.log(h))
l.emit('world', 'world') // world

console.log('tasks', l.tasks) // tasks []
```

## deepClone

```js
const test = {
  // undefined
  undefined,
  // function
  func() {
    console.log('ÊàëÊòØÂáΩÊï∞')
  },
  // ÁâπÊÆäÂØπË±°
  regexp: /\d/g,
  x: {
    x: {
      x: {
        x: {
          x: {
            x: 1
          }
        }
      }
    }
  }
}

// symbol Â±ûÊÄß
test[Symbol('symbol')] = 'symbol'
// ‰∏çÂèØÊûö‰∏æÂ±ûÊÄß
Object.defineProperty(test, 'enumObj', {
  enumerable: false,
  // getterÔºåsetter
  get() {
    return 20
  }
})

// Âæ™ÁéØÂºïÁî®
test.target = test

// ÂéüÂûãÈìæ‰∏äÁöÑÊñπÊ≥ï
const F = function () {}
F.prototype.sayHello = () => {
  console.log('ÊàëÊòØÂéüÂûãÈìæ‰∏äÁöÑÊñπÊ≥ï')
}
Object.setPrototypeOf(test, F.prototype)

const deepClone = (target, cache = new WeakMap()) => {
  if (typeof target !== 'object' || target === null) return target
  // Á¨¨‰∫åÊ¨°ËøõÊù•Â¶ÇÊûú v Âú®Â≠óÂÖ∏Ë°®ÈáåË°®Á§∫Âæ™ÁéØÂºïÁî®ÔºåÂè™ÊòØÂ§ÑÁêÜÂæ™ÁéØÂºïÁî®ÈÇ£‰∏ÄÈ°πÊó∂ÔºåÁõ¥Êé•returnÔºåÂÖ∂‰ªñÈ°πËµ∞ÁöÑÊòØ Reflect Âæ™ÁéØ
  if (cache.has(target)) return cache.get(target)
  // ‰øùËØÅÂéüÂûã‰∏äÁöÑÊñπÊ≥ï‰∏ç‰ºö‰∏¢Â§±
  const ret = Array.isArray(target) ? [] : new target.constructor()
  // ÊääËøîÂõûÂÄºÂíå Ëá™Â∑±Âª∫Á´ãÂ≠óÂÖ∏
  cache.set(target, ret)
  for (const k of Reflect.ownKeys(target)) {
    const v = target[k]
    ret[k] = typeof v === 'object' && v !== null ? deepClone(v, cache) : v
  }
  return ret
}

console.log(deepClone(test))
```

## curry

```js
// ÊüØÈáåÂåñ
// fn(1, 2, 3, 4) // ÊâßË°å...
// f = fn(1)(2)(3) // ËøîÂõûÂáΩÊï∞ÁºìÂ≠òËøô‰∏â‰∏™ÂèÇÊï∞
// f(5) // ÊâßË°å..

// const curry = fn => {
//  const g = (...allArgs) => allArgs.length >= fn.length ? fn(...allArgs) : (...args) => g(...allArgs, ...args)
//  return g
// }

// Áª¥Âü∫ÁôæÁßë‰∏äÁöÑËß£ÈáäÊòØÔºåÊääÊé•ÂèóÂ§ö‰∏™ÂèÇÊï∞ÁöÑÂáΩÊï∞ËΩ¨Êç¢ÊàêÊé•Âèó‰∏Ä‰∏™Âçï‰∏ÄÂèÇÊï∞ÁöÑÂáΩÊï∞
// ÊôÆÈÄöÂáΩÊï∞ÂèØ‰ª•ËΩ¨ÊàêÈ´òÈò∂ÂáΩÊï∞Ë∞ÉÁî®
// Áî®ÂáΩÊï∞ÂèÇÊï∞Âéª‰øùÂ≠òÂèòÈáèÔºåÈ´òÈò∂ÂáΩÊï∞Áî®Ê≥ï

const sum = (a, b, c) => {
  return a + b + c
}

console.log(
  sum(1, 2, 3) // sum(1)(2)(3)
)

// 1.0 Èó≠ÂåÖ
const _sum = a => b => c => a + b + c

console.log(_sum(1)(2)(3))

// 2.0
// ÂáΩÊï∞ÂèÇÊï∞‰øùÂ≠òÂèòÈáè
// ‰ΩéÈò∂ÂáΩÊï∞ËΩ¨È´òÈò∂ÂáΩÊï∞Ë∞ÉÁî®
// Â∞è‰∫é fn.length Êó∂,ÂÇ®Â≠òÂèÇÊï∞ÔºåËøîÂõû‰∏Ä‰∏™È´òÈò∂ÂáΩÊï∞‰ΩøÁî®gÊù•ÁºìÂ≠ò
// Á≠â‰∫é length Êó∂ ÂºÄÂßãÊâßË°åÂáΩÊï∞

const curry = fn => {
  const g = (...allArgs) =>
    allArgs.length >= fn.length ? fn(...allArgs) : (...args) => g(...args, ...allArgs)
  return g
}

console.log(curry(sum)(1)(2, 3))
```

## Object.create

```js
const origin = { a: 1 }

const o = Object.create(origin)

console.log(Object.getPrototypeOf(o) === origin, o.__proto__ === origin)

Object._create = function (origin) {
  const F = function () {}
  origin = F.prototype
  return new F()
}

const c = Object.create(origin)

console.log(Object.getPrototypeOf(c) === origin, c.__proto__ === origin)
```

## compose

```js
function add(a, b) {
  return a + b
}

function square(y) {
  return y ** 2
}

function minus(x) {
  return --x
}

console.log(minus(square(add(1, 2)))) // 8

// compose 1.0 ÂÆöÂèÇ
// ÂáΩÊï∞ÊúÄÈáåÈù¢ÊòØÊúÄÂÖàÊâßË°åÁöÑÔºå‰πüÊòØÊé•ÂèóÂèÇÊï∞ÁöÑ
function _compose(f1, f2, f3) {
  return (...args) => {
    return f3(f2(f1(...args)))
  }
}

console.log(
  _compose(add, square, minus)(1, 2) // 8
)

// compose 2.0 Êï∞ÁªÑ

// Á¨¨‰∏Ä‰∏™ÂáΩÊï∞ÊòØÊúÄÂÖàÊâßË°åÁöÑÔºå‰πüÊòØÊé•ÂèóÂèÇÊï∞ÁöÑÔºåÊé•‰∏ãÊù•ÊòØÊää‰ªñÁöÑÂÄºÂΩì‰ΩúÂèÇÊï∞‰º†ÈÄíÂà∞‰∏ã‰∏Ä‰∏™ÂáΩÊï∞
// ‰∏≠Èó¥‰ª∂‰π¶ÂÜôÈ°∫Â∫èÔºåminusÔºåsquareÔºåaddÔºåÊâÄ‰ª•ÂæóÂèçËøáÊù•ÔºåÊúÄÂêé‰∏Ä‰∏™ÂáΩÊï∞ÊòØÊúÄÂÖàÊâßË°åÁöÑÔºå‰∏≠Èó¥‰ª∂ÊòØÊúâÈ°∫Â∫èÁöÑ
// ÊâÄ‰ª• reduceRight

function compose(mids) {
  return (...args) => {
    const len = mids.length
    const _mids = mids.reverse()
    let ret
    for (let i = 0; i < len; i++) {
      if (i === 0) {
        ret = _mids[i](...args)
      } else {
        ret = _mids[i](ret)
      }
    }
    return ret
  }
}

console.log(
  compose([minus, square, add])(1, 2) // 8
)

// reduce Á¥ØÂä†Âô® ‰º†ÈÄíÁöÑÊòØÂèÇÊï∞
function composeReduce(mids) {
  return (...args) => {
    return mids.reduceRight((prev, curr) => {
      // Á¨¨‰∏Ä‰∏™ÂáΩÊï∞Ë¶ÅÁâπÊÆäÂ§ÑÁêÜ
      return typeof prev === 'function' ? curr(prev(...args)) : curr(prev)
    })
  }
}

console.log(
  composeReduce([minus, square, add])(2, 1) // 8
)

// compose 3.0 ÂºÇÊ≠•
// ÈÄíÂΩíÂÆûÁé∞
const composeAsync = mids => {
  return () => {
    const dispatch = i => {
      // fn ÊòØ async
      const fn = mids[i] // fn1

      // ÈÄíÂΩíÊù°‰ª∂
      if (!fn) return Promise.resolve()

      // next Ë∞ÉÂ∫¶
      const next = () => {
        dispatch(i + 1) // dispatch(1)
      }
      // ÊØèÊ¨°Ë∞ÉÂ∫¶ËøîÂõûÂÄº
      // next() ‰∏ÄÊâßË°å ‰∏ã‰∏Ä‰∏™Â∞± ÂÖ•Ê†àÔºåÊúÄÂêé‰∏Ä‰∏™Á´ãÂç≥ÊàêÂäüÔºå
      return Promise.resolve(fn(next)) // fn1 start -> dispatch(1)ÊâßË°å(fn2 start -> dispatch(2)() -> fn2 end) -> fn1 end
    }

    // Á¨¨‰∏ÄÊ¨°‰πüË¶ÅËøîÂõû
    return dispatch(0)
  }
}

// ÂºÇÊ≠•È°∫Â∫è‰∏çÂèòÔºåpromise Èìæ
//

async function fn1(next) {
  await new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log('fn1 start')
      resolve()
    }, 3000)
  })

  await next()
  console.log('fn1 end')
}

async function fn2(next) {
  await new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log('fn2 start')
      resolve()
    }, 1000)
  })
  await next()
  console.log('fn2 end')
}

async function fn3(next) {
  console.log('fn3 start')
  await next()
  await new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log('fn3 end')
      resolve()
    }, 1000)
  })
}

console.log(composeAsync([fn1, fn2, fn3])())

// ÂÖ•Ê†àÈ°∫Â∫èÊúâÂ∫èÔºåÂá∫Ê†àÈ°∫Â∫èÂèØ‰ª•ÊîπÂèò

// function compose(...fns) {
//  let len = fns.length
//  let res = null
//  return function fn(...arg) {
//    res = fns[len - 1].apply(null, arg) // ÊØèÊ¨°ÂáΩÊï∞ËøêË°åÁöÑÁªìÊûú
//    if(len > 1) {
//      len --
//      return fn.call(null, res) // Â∞ÜÁªìÊûúÈÄíÂΩí‰º†Áªô‰∏ã‰∏Ä‰∏™ÂáΩÊï∞
//    } else {
//      return res //ËøîÂõûÁªìÊûú
//    }
//  }
// }
```

## class

```js
// es5 Âíå es6 ÁªßÊâøÂå∫Âà´

// ÈùôÊÄÅÂ±ûÊÄßÂíåÊñπÊ≥ïÊòØÂèØË¢´ÁªßÊâøÁöÑ

// super ÂÖ≥ÈîÆÂ≠óÔºåÂØπË±°Â≠óÈù¢Èáè‰∏≠Ôºå‰ª£Ë°®ÂéüÂûãÂØπË±°
// class ‰∏≠ super(...) ‰ª£Ë°®Áà∂ class ÁöÑ constructor

class Animal {
  constructor() {
    console.log('ÊàëÂÖàÊâßË°å', this)
  }
  fn() {
    console.log('h')
  }
}

class Rabbit extends Animal {
  // ‰∏çÂÜôÁõ∏ÂΩì‰∫é
  constructor(...args) {
    super(...args) // ÊâßË°å Animal ÁöÑ constructorÔºåsuper
    // ES6 ‰∏≠Â≠êÁ±ªÊ≤°ÊúâËá™Â∑±ÁöÑthisÔºåÂøÖÈ°ªÊâßË°åsuper()ÔºåÂ≠êÁ±ªÁöÑthisÊòØ‰ªéÁà∂Á±ªÁªßÊâøÁöÑ
    // ÊâßË°åsuper() ===  Animal ÁöÑ constructor() ,Ê≠§Êó∂‰æøÊúâ‰∫Ü thisÔºåËøô‰∏§‰∏™ this ÊòØ‰∏ÄÊ†∑ÁöÑ
    console.log('ÊàëÂêéÊâßË°å', this)
  }
  // Áà∂Á±ªÊûÑÈÄ†Âô®ÊÄªÊòØ‰ºö‰ΩøÁî®ÂÆÉËá™Â∑±Â≠óÊÆµÁöÑÂÄº
}

new Animal()

console.log(Object.keys(new Animal()))

// ES5 ÁöÑÁªßÊâøÔºåÂÆûË¥®ÊòØÂÖàÂàõÈÄ†Â≠êÁ±ªÁöÑÂÆû‰æãÂØπË±°thisÔºåÁÑ∂ÂêéÂÜçÂ∞ÜÁà∂Á±ªÁöÑÊñπÊ≥ïÊ∑ªÂä†Âà∞this‰∏äÈù¢ÔºàParent.apply(this)Ôºâ„ÄÇ
// ES6 ÁöÑÁªßÊâøÊú∫Âà∂ÂÆåÂÖ®‰∏çÂêåÔºåÂÆûË¥®ÊòØÂÖàÂ∞ÜÁà∂Á±ªÂÆû‰æãÂØπË±°ÁöÑÂ±ûÊÄßÂíåÊñπÊ≥ïÔºåÂä†Âà∞this‰∏äÈù¢ÔºàÊâÄ‰ª•ÂøÖÈ°ªÂÖàË∞ÉÁî®superÊñπÊ≥ïÔºâÔºåÁÑ∂ÂêéÂÜçÁî®Â≠êÁ±ªÁöÑÊûÑÈÄ†ÂáΩÊï∞‰øÆÊîπthis

function Father() {
  // es5 Êää Áà∂ this ÊòæÁ§∫ÊîπÊàê Â≠ê this
  this.name = '100'
  console.log(this)
}

Father.c = () => console.log('c')

Father.prototype.fn = function () {
  console.log('fn')
}

const f = new Father()

Object.setPrototypeOf(Son.prototype, Father.prototype)
Object.setPrototypeOf(Son, Father)

function Son() {
  // Áõ∏ÂΩì‰∫é Father Âú®ËøôÊâßË°å
  Father.call(this)
  // this ÊòØ Son Ëá™Â∑±ÁöÑÔºå
}
console.log(Son.c())

const son = new Son()

console.log('fn' in son)
```
